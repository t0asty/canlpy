<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>canlpy.core.util.knowbert_tokenizer.vocabulary API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../knowbert_tokenizer.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;canlpy.core.util.knowbert_tokenizer</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#pop_max_vocab_size">pop_max_vocab_size</a>
            </li>
            <li>
                    <a class="function" href="#namespace_match">namespace_match</a>
            </li>
            <li>
                    <a class="class" href="#Vocabulary">Vocabulary</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Vocabulary.__init__">Vocabulary</a>
                        </li>
                        <li>
                                <a class="variable" href="#Vocabulary.default_implementation">default_implementation</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.save_to_files">save_to_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.from_files">from_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.set_from_file">set_from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.is_padded">is_padded</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.add_token_to_namespace">add_token_to_namespace</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.get_index_to_token_vocabulary">get_index_to_token_vocabulary</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.get_token_to_index_vocabulary">get_token_to_index_vocabulary</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.get_token_index">get_token_index</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.get_token_from_index">get_token_from_index</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.get_vocab_size">get_vocab_size</a>
                        </li>
                        <li>
                                <a class="function" href="#Vocabulary.print_statistics">print_statistics</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../../../canlpy.html">canlpy</a><wbr>.<a href="./../../../core.html">core</a><wbr>.<a href="./../../util.html">util</a><wbr>.<a href="./../knowbert_tokenizer.html">knowbert_tokenizer</a><wbr>.vocabulary    </h1>

                        <div class="docstring"><p>A Vocabulary maps strings to integers, allowing for strings to be mapped to an
out-of-vocabulary token.</p>
</div>

                        <input id="vocabulary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="vocabulary-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">A Vocabulary maps strings to integers, allowing for strings to be mapped to an</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">out-of-vocabulary token.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">codecs</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">copy</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TextIO</span>  <span class="c1"># pylint: disable=unused-import</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">canlpy.core.util.file_utils</span> <span class="kn">import</span> <span class="n">cached_path</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>  <span class="c1"># pylint: disable=invalid-name</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="n">DEFAULT_NON_PADDED_NAMESPACES</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;*tags&quot;</span><span class="p">,</span> <span class="s2">&quot;*labels&quot;</span><span class="p">)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="n">DEFAULT_PADDING_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;@@PADDING@@&quot;</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">DEFAULT_OOV_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;@@UNKNOWN@@&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="n">NAMESPACE_PADDING_FILE</span> <span class="o">=</span> <span class="s1">&#39;non_padded_namespaces.txt&#39;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="k">class</span> <span class="nc">_NamespaceDependentDefaultDict</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    This is a `defaultdict</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    &lt;https://docs.python.org/2/library/collections.html#collections.defaultdict&gt;`_ where the</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    default value is dependent on the key that is passed.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    We use &quot;namespaces&quot; in the :class:`Vocabulary` object to keep track of several different</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    mappings from strings to integers, so that we have a consistent API for mapping words, tags,</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    labels, characters, or whatever else you want, into integers.  The issue is that some of those</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    namespaces (words and characters) should have integers reserved for padding and</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">    out-of-vocabulary tokens, while others (labels and tags) shouldn&#39;t.  This class allows you to</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    specify filters on the namespace (the key used in the ``defaultdict``), and use different</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    default values depending on whether the namespace passes the filter.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    To do filtering, we take a set of ``non_padded_namespaces``.  This is a set of strings</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    that are either matched exactly against the keys, or treated as suffixes, if the</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    string starts with ``*``.  In other words, if ``*tags`` is in ``non_padded_namespaces`` then</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    ``passage_tags``, ``question_tags``, etc. (anything that ends with ``tags``) will have the</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    ``non_padded`` default value.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    Parameters</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    ----------</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    non_padded_namespaces : ``Iterable[str]``</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        A set / list / tuple of strings describing which namespaces are not padded.  If a namespace</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        (key) is missing from this dictionary, we will use :func:`namespace_match` to see whether</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        the namespace should be padded.  If the given namespace matches any of the strings in this</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        list, we will use ``non_padded_function`` to initialize the value for that namespace, and</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        we will use ``padded_function`` otherwise.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">    padded_function : ``Callable[[], Any]``</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        A zero-argument function to call to initialize a value for a namespace that `should` be</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        padded.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">    non_padded_function : ``Callable[[], Any]``</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        A zero-argument function to call to initialize a value for a namespace that should `not` be</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        padded.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>                 <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>                 <span class="n">padded_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>                 <span class="n">non_padded_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padded_function</span> <span class="o">=</span> <span class="n">padded_function</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_function</span> <span class="o">=</span> <span class="n">non_padded_function</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">_NamespaceDependentDefaultDict</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="fm">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_function</span><span class="p">()</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padded_function</span><span class="p">()</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">add_non_padded_namespaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="c1"># add non_padded_namespaces which weren&#39;t already present</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="k">class</span> <span class="nc">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="n">_NamespaceDependentDefaultDict</span><span class="p">):</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">padding_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="n">padding_token</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">oov_token</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="k">class</span> <span class="nc">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="n">_NamespaceDependentDefaultDict</span><span class="p">):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">padding_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                                                       <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">padding_token</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="n">oov_token</span><span class="p">},</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                                                       <span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="k">def</span> <span class="nf">_read_pretrained_tokens</span><span class="p">(</span><span class="n">embeddings_file_uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="c1">#from allennlp.  import EmbeddingsTextFile</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="c1"># logger.info(&#39;Reading pretrained tokens from: %s&#39;, embeddings_file_uri)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="c1"># tokens: List[str] = []</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="c1"># with EmbeddingsTextFile(embeddings_file_uri) as embeddings_file:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="c1">#     for line_number, line in enumerate(tqdm(embeddings_file), start=1):</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="c1">#         token_end = line.find(&#39; &#39;)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>    <span class="c1">#         if token_end &gt;= 0:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="c1">#             token = line[:token_end]</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>    <span class="c1">#             tokens.append(token)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="c1">#         else:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="c1">#             line_begin = line[:20] + &#39;...&#39; if len(line) &gt; 20 else line</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="c1">#             logger.warning(f&#39;Skipping line number %d: %s&#39;, line_number, line_begin)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="c1"># return tokens</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="k">def</span> <span class="nf">pop_max_vocab_size</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">    max_vocab_size is allowed to be either an int or a Dict[str, int] (or nothing).</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">    But it could also be a string representing an int (in the case of environment variable</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">    substitution). So we need some complex logic to handle it.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_vocab_size&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="c1"># This is the Dict[str, int] case.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">elif</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="c1"># This is the int / str case.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="k">def</span> <span class="nf">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    Matches a namespace pattern against a namespace string.  For example, ``*tags`` matches</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">    ``passage_tags`` and ``question_tags`` and ``tokens`` matches ``tokens`` but not</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    ``stemmed_tokens``.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="n">namespace</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">namespace</span><span class="p">:</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="k">class</span> <span class="nc">Vocabulary</span><span class="p">():</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">    A Vocabulary maps strings to integers, allowing for strings to be mapped to an</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">    out-of-vocabulary token.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">    Vocabularies are fit to a particular dataset, which we use to decide which tokens are</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">    in-vocabulary.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">    Vocabularies also allow for several different namespaces, so you can have separate indices for</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">    &#39;a&#39; as a word, and &#39;a&#39; as a character, for instance, and so we can use this object to also map</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">    tag and label strings to indices.  Most of the</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    methods on this class allow you to pass in a namespace; by default we use the &#39;tokens&#39;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">    namespace, and you can omit the namespace argument everywhere and just use the default.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">    Parameters</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    ----------</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    counter : ``Dict[str, Dict[str, int]]``, optional (default=``None``)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        A collection of counts from which to initialize this vocabulary.  We will examine the</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        counts and, together with the other parameters to this class, use them to decide which</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        words are in-vocabulary.  If this is ``None``, we just won&#39;t initialize the vocabulary with</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        anything.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">    min_count : ``Dict[str, int]``, optional (default=None)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        When initializing the vocab from a counter, you can specify a minimum count, and every</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        token with a count less than this will not be added to the dictionary.  These minimum</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        counts are `namespace-specific`, so you can specify different minimums for labels versus</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">        words tokens, for example.  If a namespace does not have a key in the given dictionary, we</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        will add all seen tokens to that namespace.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">    max_vocab_size : ``Union[int, Dict[str, int]]``, optional (default=``None``)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        If you want to cap the number of tokens in your vocabulary, you can do so with this</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        parameter.  If you specify a single integer, every namespace will have its vocabulary fixed</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">        to be no larger than this.  If you specify a dictionary, then each namespace in the</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        ``counter`` can have a separate maximum vocabulary size.  Any missing key will have a value</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        of ``None``, which means no cap on the vocabulary size.</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    non_padded_namespaces : ``Iterable[str]``, optional</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        By default, we assume you are mapping word / character tokens to integers, and so you want</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        to reserve word indices for padding and out-of-vocabulary tokens.  However, if you are</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        mapping NER or SRL tags, or class labels, to integers, you probably do not want to reserve</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        indices for padding and out-of-vocabulary tokens.  Use this field to specify which</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        namespaces should `not` have padding and OOV tokens added.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        The format of each element of this is either a string, which must match field names</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        exactly,  or ``*`` followed by a string, which we match as a suffix against field names.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        We try to make the default here reasonable, so that you don&#39;t have to think about this.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        The default is ``(&quot;*tags&quot;, &quot;*labels&quot;)``, so as long as your namespace ends in &quot;tags&quot; or</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">        &quot;labels&quot; (which is true by default for all tag and label fields in this code), you don&#39;t</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        have to specify anything here.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">    pretrained_files : ``Dict[str, str]``, optional</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        If provided, this map specifies the path to optional pretrained embedding files for each</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a><span class="sd">        namespace. This can be used to either restrict the vocabulary to only words which appear</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="sd">        in this file, or to ensure that any words in this file are included in the vocabulary</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        regardless of their count, depending on the value of ``only_include_pretrained_words``.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        Words which appear in the pretrained embedding file but not in the data are NOT included</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        in the Vocabulary.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">    min_pretrained_embeddings : ``Dict[str, int]``, optional</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        If provided, specifies for each namespace a minimum number of lines (typically the</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        most common words) to keep from pretrained embedding files, even for words not</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">        appearing in the data.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">    only_include_pretrained_words : ``bool``, optional (default=False)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a><span class="sd">        This defines the strategy for using any pretrained embedding files which may have been</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        specified in ``pretrained_files``. If False, an inclusive strategy is used: and words</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">        which are in the ``counter`` and in the pretrained file are added to the ``Vocabulary``,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">        regardless of whether their count exceeds ``min_count`` or not. If True, we use an</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        exclusive strategy: words are only included in the Vocabulary if they are in the pretrained</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        embedding file (their count must still be at least ``min_count``).</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">    tokens_to_add : ``Dict[str, List[str]]``, optional (default=None)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        If given, this is a list of tokens to add to the vocabulary, keyed by the namespace to add</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        the tokens to.  This is a way to be sure that certain items appear in your vocabulary,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        regardless of any other vocabulary computation.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="n">default_implementation</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                 <span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                 <span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                 <span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                 <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NON_PADDED_NAMESPACES</span><span class="p">,</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                 <span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                 <span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                 <span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                 <span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="o">=</span> <span class="n">DEFAULT_PADDING_TOKEN</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span> <span class="o">=</span> <span class="n">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span> <span class="o">=</span> <span class="n">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="c1"># Made an empty vocabulary, now extend it.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                     <span class="n">min_count</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                     <span class="n">max_vocab_size</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                     <span class="n">non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                     <span class="n">pretrained_files</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                     <span class="n">only_include_pretrained_words</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                     <span class="n">tokens_to_add</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                     <span class="n">min_pretrained_embeddings</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        Need to sanitize defaultdict and defaultdict-like objects</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        by converting them to vanilla dicts when we pickle the vocabulary.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">])</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">])</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="s2">&quot;_retained_counter&quot;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_retained_counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>                                          <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_retained_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="n">state</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        Conversely, when we unpickle, we need to reload the plain dicts</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        into our special DefaultDict subclasses.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="c1"># pylint: disable=attribute-defined-outside-init</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span> <span class="o">=</span> <span class="n">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">])</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span> <span class="o">=</span> <span class="n">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">])</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="nf">save_to_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        Persist this Vocabulary to files so it can be reloaded later.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">        Each namespace corresponds to one file.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">        Parameters</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a><span class="sd">        ----------</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        directory : ``str``</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            The directory where we save the serialized vocabulary.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;vocabulary serialization directory </span><span class="si">%s</span><span class="s2"> is not empty&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">namespace_str</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">namespace_file</span><span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="c1"># Each namespace gets written to its own file, in index order.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">token_file</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                <span class="n">start_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">num_tokens</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">token_file</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vocabulary&#39;</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        Loads a ``Vocabulary`` that was serialized using ``save_to_files``.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        Parameters</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        ----------</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        directory : ``str``</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">            The directory containing the serialized vocabulary.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="kn">import</span> <span class="nn">tempfile</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="kn">import</span> <span class="nn">tarfile</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="kn">import</span> <span class="nn">atexit</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;removing temporary unarchived model dir at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading token dictionary from </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="c1"># download and decompress if needed</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">cached_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="k">pass</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="c1"># Extract to temp dir</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extracting file </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> to temp dir </span><span class="si">{</span><span class="n">tempdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;r:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">archive</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>                <span class="n">archive</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="c1"># Postpone cleanup until exit in case the unarchived contents are needed outside</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="c1"># this function.</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_cleanup</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="n">directory</span> <span class="o">=</span> <span class="n">tempdir</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">namespace_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="n">namespace_file</span><span class="p">]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="o">=</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="c1"># Check every file in the directory.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="k">for</span> <span class="n">namespace_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span> <span class="o">==</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="k">continue</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="k">continue</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">non_padded_namespaces</span><span class="p">):</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace_filename</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">vocab</span><span class="o">.</span><span class="n">set_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">is_padded</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="k">def</span> <span class="nf">set_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                      <span class="n">is_padded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                      <span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                      <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tokens&quot;</span><span class="p">):</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        If you already have a vocabulary file for a trained model somewhere, and you really want to</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        use that vocabulary file instead of just setting the vocabulary from a dataset, for</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        whatever reason, you can do that with this method.  You must specify the namespace to use,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        and we assume that you want to use padding and OOV tokens for this.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="sd">        Parameters</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">        ----------</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">        filename : ``str``</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">            The file containing the vocabulary to load.  It should be formatted as one token per</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">            line, with nothing else in the line.  The index we assign to the token is the line</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">            number in the file (1-indexed if ``is_padded``, 0-indexed otherwise).  Note that this</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">            file should contain the OOV token string!</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">        is_padded : ``bool``, optional (default=True)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">            Is this vocabulary padded?  For token / word / character vocabularies, this should be</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">            ``True``; while for tag or label vocabularies, this should typically be ``False``.  If</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">            ``True``, we add a padding token with index 0, and we enforce that the ``oov_token`` is</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">            present in the file.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">        oov_token : ``str``, optional (default=DEFAULT_OOV_TOKEN)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">            What token does this vocabulary use to represent out-of-vocabulary characters?  This</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">            must show up as a line in the vocabulary file.  When we find it, we replace</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">            ``oov_token`` with ``self._oov_token``, because we only use one OOV token across</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">            namespaces.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        namespace : ``str``, optional (default=&quot;tokens&quot;)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">            What namespace should we overwrite with this vocab file?</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">}</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="c1"># Be flexible about having final newline or not</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_padded</span> <span class="k">else</span> <span class="n">i</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">oov_token</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">],</span> <span class="s2">&quot;OOV token not found!&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>   
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="k">def</span> <span class="nf">_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>                <span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>                <span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>                <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NON_PADDED_NAMESPACES</span><span class="p">,</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                <span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                <span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        This method can be used for extending already generated vocabulary.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">        It takes same parameters as Vocabulary initializer. The token2index</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        and indextotoken mappings of calling vocabulary will be retained.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        It is an inplace operation so None will be returned.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_vocab_size</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">int_max_vocab_size</span> <span class="o">=</span> <span class="n">max_vocab_size</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">max_vocab_size</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">int_max_vocab_size</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="n">min_count</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="n">pretrained_files</span> <span class="o">=</span> <span class="n">pretrained_files</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="n">min_pretrained_embeddings</span> <span class="o">=</span> <span class="n">min_pretrained_embeddings</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="n">tokens_to_add</span> <span class="o">=</span> <span class="n">tokens_to_add</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span> <span class="o">=</span> <span class="n">counter</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="c1"># Make sure vocabulary extension is safe.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="n">current_namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">}</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">extension_namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">counter</span><span class="p">,</span> <span class="o">*</span><span class="n">tokens_to_add</span><span class="p">}</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">current_namespaces</span> <span class="o">&amp;</span> <span class="n">extension_namespaces</span><span class="p">:</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>            <span class="c1"># if new namespace was already present</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="c1"># Either both should be padded or none should be.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">original_padded</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                                      <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>            <span class="n">extension_padded</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                                       <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="k">if</span> <span class="n">original_padded</span> <span class="o">!=</span> <span class="n">extension_padded</span><span class="p">:</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Common namespace </span><span class="si">{}</span><span class="s2"> has conflicting &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">+</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                                         <span class="s2">&quot;setting of padded = True/False. &quot;</span><span class="o">+</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                                         <span class="s2">&quot;Hence extension cannot be done.&quot;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="c1"># Add new non-padded namespaces for extension</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="o">.</span><span class="n">add_non_padded_namespaces</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">add_non_padded_namespaces</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">counter</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">pretrained_files</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>                <span class="n">pretrained_list</span> <span class="o">=</span> <span class="n">_read_pretrained_tokens</span><span class="p">(</span><span class="n">pretrained_files</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                <span class="n">min_embeddings</span> <span class="o">=</span> <span class="n">min_pretrained_embeddings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="k">if</span> <span class="n">min_embeddings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>                    <span class="n">tokens_old</span> <span class="o">=</span> <span class="n">tokens_to_add</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>                    <span class="n">tokens_new</span> <span class="o">=</span> <span class="n">pretrained_list</span><span class="p">[:</span><span class="n">min_embeddings</span><span class="p">]</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                    <span class="n">tokens_to_add</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens_old</span> <span class="o">+</span> <span class="n">tokens_new</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                <span class="n">pretrained_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pretrained_list</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                <span class="n">pretrained_set</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>            <span class="n">token_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">token_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>                <span class="n">max_vocab</span> <span class="o">=</span> <span class="n">max_vocab_size</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>                <span class="n">max_vocab</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>            <span class="k">if</span> <span class="n">max_vocab</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>                <span class="n">token_counts</span> <span class="o">=</span> <span class="n">token_counts</span><span class="p">[:</span><span class="n">max_vocab</span><span class="p">]</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>            <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">token_counts</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                <span class="k">if</span> <span class="n">pretrained_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>                    <span class="k">if</span> <span class="n">only_include_pretrained_words</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>                        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">pretrained_set</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>                    <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">pretrained_set</span> <span class="ow">or</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokens_to_add</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">is_padded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        Returns whether or not there are padding and OOV tokens added to the given namespace.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">add_token_to_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        Adds ``token`` to the index, if it is not already present.  Either way, we return the index of</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">        the token.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vocabulary tokens must be strings, or saving and loading will break.&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>                             <span class="s2">&quot;  Got </span><span class="si">%s</span><span class="s2"> (with type </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">token</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">token</span><span class="p">)))</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="k">return</span> <span class="n">index</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>    <span class="k">def</span> <span class="nf">get_index_to_token_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>    <span class="k">def</span> <span class="nf">get_token_to_index_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">get_token_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">]</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Namespace: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Token: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>                <span class="k">raise</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>    <span class="k">def</span> <span class="nf">get_token_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="k">def</span> <span class="nf">get_vocab_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="n">base_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary with namespaces:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Non Padded Namespaces: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Namespace: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vocab_size</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                      <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_string</span><span class="p">,</span> <span class="n">non_padded_namespaces</span><span class="p">]</span> <span class="o">+</span> <span class="n">namespaces</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="c1"># This is essentially the same as __str__, but with no newlines</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="n">base_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary with namespaces: &quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="n">namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vocab_size</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2"> ||&quot;</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>                      <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">]</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Non Padded Namespaces: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_string</span><span class="p">]</span> <span class="o">+</span> <span class="n">namespaces</span> <span class="o">+</span> <span class="p">[</span><span class="n">non_padded_namespaces</span><span class="p">])</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="k">def</span> <span class="nf">print_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Printed vocabulary statistics are only for the part of the vocabulary generated &quot;</span> \
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>                        <span class="s2">&quot;from instances. If vocabulary is constructed by extending saved vocabulary with &quot;</span> \
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>                        <span class="s2">&quot;dataset instances, the directly loaded portion won&#39;t be considered here.&quot;</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">----Vocabulary Statistics----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="c1"># Since we don&#39;t saved counter info, it is impossible to consider pre-saved portion.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>                <span class="n">tokens_with_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 most frequent tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>                <span class="c1"># Now sort by token length, not frequency</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 longest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 shortest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tokens_with_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>            <span class="c1"># _retained_counter would be set only if instances were used for vocabulary construction.</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vocabulary statistics cannot be printed since &quot;</span> \
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>                        <span class="s2">&quot;dataset instances were not used for its construction.&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="pop_max_vocab_size">
                            <input id="pop_max_vocab_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pop_max_vocab_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="pop_max_vocab_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pop_max_vocab_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pop_max_vocab_size-109"><a href="#pop_max_vocab_size-109"><span class="linenos">109</span></a><span class="k">def</span> <span class="nf">pop_max_vocab_size</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="pop_max_vocab_size-110"><a href="#pop_max_vocab_size-110"><span class="linenos">110</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="pop_max_vocab_size-111"><a href="#pop_max_vocab_size-111"><span class="linenos">111</span></a><span class="sd">    max_vocab_size is allowed to be either an int or a Dict[str, int] (or nothing).</span>
</span><span id="pop_max_vocab_size-112"><a href="#pop_max_vocab_size-112"><span class="linenos">112</span></a><span class="sd">    But it could also be a string representing an int (in the case of environment variable</span>
</span><span id="pop_max_vocab_size-113"><a href="#pop_max_vocab_size-113"><span class="linenos">113</span></a><span class="sd">    substitution). So we need some complex logic to handle it.</span>
</span><span id="pop_max_vocab_size-114"><a href="#pop_max_vocab_size-114"><span class="linenos">114</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="pop_max_vocab_size-115"><a href="#pop_max_vocab_size-115"><span class="linenos">115</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;max_vocab_size&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="pop_max_vocab_size-116"><a href="#pop_max_vocab_size-116"><span class="linenos">116</span></a>
</span><span id="pop_max_vocab_size-117"><a href="#pop_max_vocab_size-117"><span class="linenos">117</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="pop_max_vocab_size-118"><a href="#pop_max_vocab_size-118"><span class="linenos">118</span></a>        <span class="c1"># This is the Dict[str, int] case.</span>
</span><span id="pop_max_vocab_size-119"><a href="#pop_max_vocab_size-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="n">size</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
</span><span id="pop_max_vocab_size-120"><a href="#pop_max_vocab_size-120"><span class="linenos">120</span></a>    <span class="k">elif</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="pop_max_vocab_size-121"><a href="#pop_max_vocab_size-121"><span class="linenos">121</span></a>        <span class="c1"># This is the int / str case.</span>
</span><span id="pop_max_vocab_size-122"><a href="#pop_max_vocab_size-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="pop_max_vocab_size-123"><a href="#pop_max_vocab_size-123"><span class="linenos">123</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="pop_max_vocab_size-124"><a href="#pop_max_vocab_size-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>max_vocab_size is allowed to be either an int or a Dict[str, int] (or nothing).
But it could also be a string representing an int (in the case of environment variable
substitution). So we need some complex logic to handle it.</p>
</div>


                </section>
                <section id="namespace_match">
                            <input id="namespace_match-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">namespace_match</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="namespace_match-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#namespace_match"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="namespace_match-126"><a href="#namespace_match-126"><span class="linenos">126</span></a><span class="k">def</span> <span class="nf">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="namespace_match-127"><a href="#namespace_match-127"><span class="linenos">127</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="namespace_match-128"><a href="#namespace_match-128"><span class="linenos">128</span></a><span class="sd">    Matches a namespace pattern against a namespace string.  For example, ``*tags`` matches</span>
</span><span id="namespace_match-129"><a href="#namespace_match-129"><span class="linenos">129</span></a><span class="sd">    ``passage_tags`` and ``question_tags`` and ``tokens`` matches ``tokens`` but not</span>
</span><span id="namespace_match-130"><a href="#namespace_match-130"><span class="linenos">130</span></a><span class="sd">    ``stemmed_tokens``.</span>
</span><span id="namespace_match-131"><a href="#namespace_match-131"><span class="linenos">131</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="namespace_match-132"><a href="#namespace_match-132"><span class="linenos">132</span></a>    <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span> <span class="ow">and</span> <span class="n">namespace</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
</span><span id="namespace_match-133"><a href="#namespace_match-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="namespace_match-134"><a href="#namespace_match-134"><span class="linenos">134</span></a>    <span class="k">elif</span> <span class="n">pattern</span> <span class="o">==</span> <span class="n">namespace</span><span class="p">:</span>
</span><span id="namespace_match-135"><a href="#namespace_match-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="namespace_match-136"><a href="#namespace_match-136"><span class="linenos">136</span></a>    <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Matches a namespace pattern against a namespace string.  For example, <code>*tags</code> matches
<code>passage_tags</code> and <code>question_tags</code> and <code>tokens</code> matches <code>tokens</code> but not
<code>stemmed_tokens</code>.</p>
</div>


                </section>
                <section id="Vocabulary">
                            <input id="Vocabulary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Vocabulary</span>:

                <label class="view-source-button" for="Vocabulary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary-138"><a href="#Vocabulary-138"><span class="linenos">138</span></a><span class="k">class</span> <span class="nc">Vocabulary</span><span class="p">():</span>
</span><span id="Vocabulary-139"><a href="#Vocabulary-139"><span class="linenos">139</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-140"><a href="#Vocabulary-140"><span class="linenos">140</span></a><span class="sd">    A Vocabulary maps strings to integers, allowing for strings to be mapped to an</span>
</span><span id="Vocabulary-141"><a href="#Vocabulary-141"><span class="linenos">141</span></a><span class="sd">    out-of-vocabulary token.</span>
</span><span id="Vocabulary-142"><a href="#Vocabulary-142"><span class="linenos">142</span></a>
</span><span id="Vocabulary-143"><a href="#Vocabulary-143"><span class="linenos">143</span></a><span class="sd">    Vocabularies are fit to a particular dataset, which we use to decide which tokens are</span>
</span><span id="Vocabulary-144"><a href="#Vocabulary-144"><span class="linenos">144</span></a><span class="sd">    in-vocabulary.</span>
</span><span id="Vocabulary-145"><a href="#Vocabulary-145"><span class="linenos">145</span></a>
</span><span id="Vocabulary-146"><a href="#Vocabulary-146"><span class="linenos">146</span></a><span class="sd">    Vocabularies also allow for several different namespaces, so you can have separate indices for</span>
</span><span id="Vocabulary-147"><a href="#Vocabulary-147"><span class="linenos">147</span></a><span class="sd">    &#39;a&#39; as a word, and &#39;a&#39; as a character, for instance, and so we can use this object to also map</span>
</span><span id="Vocabulary-148"><a href="#Vocabulary-148"><span class="linenos">148</span></a><span class="sd">    tag and label strings to indices.  Most of the</span>
</span><span id="Vocabulary-149"><a href="#Vocabulary-149"><span class="linenos">149</span></a><span class="sd">    methods on this class allow you to pass in a namespace; by default we use the &#39;tokens&#39;</span>
</span><span id="Vocabulary-150"><a href="#Vocabulary-150"><span class="linenos">150</span></a><span class="sd">    namespace, and you can omit the namespace argument everywhere and just use the default.</span>
</span><span id="Vocabulary-151"><a href="#Vocabulary-151"><span class="linenos">151</span></a>
</span><span id="Vocabulary-152"><a href="#Vocabulary-152"><span class="linenos">152</span></a><span class="sd">    Parameters</span>
</span><span id="Vocabulary-153"><a href="#Vocabulary-153"><span class="linenos">153</span></a><span class="sd">    ----------</span>
</span><span id="Vocabulary-154"><a href="#Vocabulary-154"><span class="linenos">154</span></a><span class="sd">    counter : ``Dict[str, Dict[str, int]]``, optional (default=``None``)</span>
</span><span id="Vocabulary-155"><a href="#Vocabulary-155"><span class="linenos">155</span></a><span class="sd">        A collection of counts from which to initialize this vocabulary.  We will examine the</span>
</span><span id="Vocabulary-156"><a href="#Vocabulary-156"><span class="linenos">156</span></a><span class="sd">        counts and, together with the other parameters to this class, use them to decide which</span>
</span><span id="Vocabulary-157"><a href="#Vocabulary-157"><span class="linenos">157</span></a><span class="sd">        words are in-vocabulary.  If this is ``None``, we just won&#39;t initialize the vocabulary with</span>
</span><span id="Vocabulary-158"><a href="#Vocabulary-158"><span class="linenos">158</span></a><span class="sd">        anything.</span>
</span><span id="Vocabulary-159"><a href="#Vocabulary-159"><span class="linenos">159</span></a><span class="sd">    min_count : ``Dict[str, int]``, optional (default=None)</span>
</span><span id="Vocabulary-160"><a href="#Vocabulary-160"><span class="linenos">160</span></a><span class="sd">        When initializing the vocab from a counter, you can specify a minimum count, and every</span>
</span><span id="Vocabulary-161"><a href="#Vocabulary-161"><span class="linenos">161</span></a><span class="sd">        token with a count less than this will not be added to the dictionary.  These minimum</span>
</span><span id="Vocabulary-162"><a href="#Vocabulary-162"><span class="linenos">162</span></a><span class="sd">        counts are `namespace-specific`, so you can specify different minimums for labels versus</span>
</span><span id="Vocabulary-163"><a href="#Vocabulary-163"><span class="linenos">163</span></a><span class="sd">        words tokens, for example.  If a namespace does not have a key in the given dictionary, we</span>
</span><span id="Vocabulary-164"><a href="#Vocabulary-164"><span class="linenos">164</span></a><span class="sd">        will add all seen tokens to that namespace.</span>
</span><span id="Vocabulary-165"><a href="#Vocabulary-165"><span class="linenos">165</span></a><span class="sd">    max_vocab_size : ``Union[int, Dict[str, int]]``, optional (default=``None``)</span>
</span><span id="Vocabulary-166"><a href="#Vocabulary-166"><span class="linenos">166</span></a><span class="sd">        If you want to cap the number of tokens in your vocabulary, you can do so with this</span>
</span><span id="Vocabulary-167"><a href="#Vocabulary-167"><span class="linenos">167</span></a><span class="sd">        parameter.  If you specify a single integer, every namespace will have its vocabulary fixed</span>
</span><span id="Vocabulary-168"><a href="#Vocabulary-168"><span class="linenos">168</span></a><span class="sd">        to be no larger than this.  If you specify a dictionary, then each namespace in the</span>
</span><span id="Vocabulary-169"><a href="#Vocabulary-169"><span class="linenos">169</span></a><span class="sd">        ``counter`` can have a separate maximum vocabulary size.  Any missing key will have a value</span>
</span><span id="Vocabulary-170"><a href="#Vocabulary-170"><span class="linenos">170</span></a><span class="sd">        of ``None``, which means no cap on the vocabulary size.</span>
</span><span id="Vocabulary-171"><a href="#Vocabulary-171"><span class="linenos">171</span></a><span class="sd">    non_padded_namespaces : ``Iterable[str]``, optional</span>
</span><span id="Vocabulary-172"><a href="#Vocabulary-172"><span class="linenos">172</span></a><span class="sd">        By default, we assume you are mapping word / character tokens to integers, and so you want</span>
</span><span id="Vocabulary-173"><a href="#Vocabulary-173"><span class="linenos">173</span></a><span class="sd">        to reserve word indices for padding and out-of-vocabulary tokens.  However, if you are</span>
</span><span id="Vocabulary-174"><a href="#Vocabulary-174"><span class="linenos">174</span></a><span class="sd">        mapping NER or SRL tags, or class labels, to integers, you probably do not want to reserve</span>
</span><span id="Vocabulary-175"><a href="#Vocabulary-175"><span class="linenos">175</span></a><span class="sd">        indices for padding and out-of-vocabulary tokens.  Use this field to specify which</span>
</span><span id="Vocabulary-176"><a href="#Vocabulary-176"><span class="linenos">176</span></a><span class="sd">        namespaces should `not` have padding and OOV tokens added.</span>
</span><span id="Vocabulary-177"><a href="#Vocabulary-177"><span class="linenos">177</span></a>
</span><span id="Vocabulary-178"><a href="#Vocabulary-178"><span class="linenos">178</span></a><span class="sd">        The format of each element of this is either a string, which must match field names</span>
</span><span id="Vocabulary-179"><a href="#Vocabulary-179"><span class="linenos">179</span></a><span class="sd">        exactly,  or ``*`` followed by a string, which we match as a suffix against field names.</span>
</span><span id="Vocabulary-180"><a href="#Vocabulary-180"><span class="linenos">180</span></a>
</span><span id="Vocabulary-181"><a href="#Vocabulary-181"><span class="linenos">181</span></a><span class="sd">        We try to make the default here reasonable, so that you don&#39;t have to think about this.</span>
</span><span id="Vocabulary-182"><a href="#Vocabulary-182"><span class="linenos">182</span></a><span class="sd">        The default is ``(&quot;*tags&quot;, &quot;*labels&quot;)``, so as long as your namespace ends in &quot;tags&quot; or</span>
</span><span id="Vocabulary-183"><a href="#Vocabulary-183"><span class="linenos">183</span></a><span class="sd">        &quot;labels&quot; (which is true by default for all tag and label fields in this code), you don&#39;t</span>
</span><span id="Vocabulary-184"><a href="#Vocabulary-184"><span class="linenos">184</span></a><span class="sd">        have to specify anything here.</span>
</span><span id="Vocabulary-185"><a href="#Vocabulary-185"><span class="linenos">185</span></a><span class="sd">    pretrained_files : ``Dict[str, str]``, optional</span>
</span><span id="Vocabulary-186"><a href="#Vocabulary-186"><span class="linenos">186</span></a><span class="sd">        If provided, this map specifies the path to optional pretrained embedding files for each</span>
</span><span id="Vocabulary-187"><a href="#Vocabulary-187"><span class="linenos">187</span></a><span class="sd">        namespace. This can be used to either restrict the vocabulary to only words which appear</span>
</span><span id="Vocabulary-188"><a href="#Vocabulary-188"><span class="linenos">188</span></a><span class="sd">        in this file, or to ensure that any words in this file are included in the vocabulary</span>
</span><span id="Vocabulary-189"><a href="#Vocabulary-189"><span class="linenos">189</span></a><span class="sd">        regardless of their count, depending on the value of ``only_include_pretrained_words``.</span>
</span><span id="Vocabulary-190"><a href="#Vocabulary-190"><span class="linenos">190</span></a><span class="sd">        Words which appear in the pretrained embedding file but not in the data are NOT included</span>
</span><span id="Vocabulary-191"><a href="#Vocabulary-191"><span class="linenos">191</span></a><span class="sd">        in the Vocabulary.</span>
</span><span id="Vocabulary-192"><a href="#Vocabulary-192"><span class="linenos">192</span></a><span class="sd">    min_pretrained_embeddings : ``Dict[str, int]``, optional</span>
</span><span id="Vocabulary-193"><a href="#Vocabulary-193"><span class="linenos">193</span></a><span class="sd">        If provided, specifies for each namespace a minimum number of lines (typically the</span>
</span><span id="Vocabulary-194"><a href="#Vocabulary-194"><span class="linenos">194</span></a><span class="sd">        most common words) to keep from pretrained embedding files, even for words not</span>
</span><span id="Vocabulary-195"><a href="#Vocabulary-195"><span class="linenos">195</span></a><span class="sd">        appearing in the data.</span>
</span><span id="Vocabulary-196"><a href="#Vocabulary-196"><span class="linenos">196</span></a><span class="sd">    only_include_pretrained_words : ``bool``, optional (default=False)</span>
</span><span id="Vocabulary-197"><a href="#Vocabulary-197"><span class="linenos">197</span></a><span class="sd">        This defines the strategy for using any pretrained embedding files which may have been</span>
</span><span id="Vocabulary-198"><a href="#Vocabulary-198"><span class="linenos">198</span></a><span class="sd">        specified in ``pretrained_files``. If False, an inclusive strategy is used: and words</span>
</span><span id="Vocabulary-199"><a href="#Vocabulary-199"><span class="linenos">199</span></a><span class="sd">        which are in the ``counter`` and in the pretrained file are added to the ``Vocabulary``,</span>
</span><span id="Vocabulary-200"><a href="#Vocabulary-200"><span class="linenos">200</span></a><span class="sd">        regardless of whether their count exceeds ``min_count`` or not. If True, we use an</span>
</span><span id="Vocabulary-201"><a href="#Vocabulary-201"><span class="linenos">201</span></a><span class="sd">        exclusive strategy: words are only included in the Vocabulary if they are in the pretrained</span>
</span><span id="Vocabulary-202"><a href="#Vocabulary-202"><span class="linenos">202</span></a><span class="sd">        embedding file (their count must still be at least ``min_count``).</span>
</span><span id="Vocabulary-203"><a href="#Vocabulary-203"><span class="linenos">203</span></a><span class="sd">    tokens_to_add : ``Dict[str, List[str]]``, optional (default=None)</span>
</span><span id="Vocabulary-204"><a href="#Vocabulary-204"><span class="linenos">204</span></a><span class="sd">        If given, this is a list of tokens to add to the vocabulary, keyed by the namespace to add</span>
</span><span id="Vocabulary-205"><a href="#Vocabulary-205"><span class="linenos">205</span></a><span class="sd">        the tokens to.  This is a way to be sure that certain items appear in your vocabulary,</span>
</span><span id="Vocabulary-206"><a href="#Vocabulary-206"><span class="linenos">206</span></a><span class="sd">        regardless of any other vocabulary computation.</span>
</span><span id="Vocabulary-207"><a href="#Vocabulary-207"><span class="linenos">207</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Vocabulary-208"><a href="#Vocabulary-208"><span class="linenos">208</span></a>    <span class="n">default_implementation</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</span><span id="Vocabulary-209"><a href="#Vocabulary-209"><span class="linenos">209</span></a>
</span><span id="Vocabulary-210"><a href="#Vocabulary-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vocabulary-211"><a href="#Vocabulary-211"><span class="linenos">211</span></a>                 <span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-212"><a href="#Vocabulary-212"><span class="linenos">212</span></a>                 <span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-213"><a href="#Vocabulary-213"><span class="linenos">213</span></a>                 <span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-214"><a href="#Vocabulary-214"><span class="linenos">214</span></a>                 <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NON_PADDED_NAMESPACES</span><span class="p">,</span>
</span><span id="Vocabulary-215"><a href="#Vocabulary-215"><span class="linenos">215</span></a>                 <span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-216"><a href="#Vocabulary-216"><span class="linenos">216</span></a>                 <span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Vocabulary-217"><a href="#Vocabulary-217"><span class="linenos">217</span></a>                 <span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-218"><a href="#Vocabulary-218"><span class="linenos">218</span></a>                 <span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary-219"><a href="#Vocabulary-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="o">=</span> <span class="n">DEFAULT_PADDING_TOKEN</span>
</span><span id="Vocabulary-220"><a href="#Vocabulary-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span>
</span><span id="Vocabulary-221"><a href="#Vocabulary-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-222"><a href="#Vocabulary-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span> <span class="o">=</span> <span class="n">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary-223"><a href="#Vocabulary-223"><span class="linenos">223</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary-224"><a href="#Vocabulary-224"><span class="linenos">224</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary-225"><a href="#Vocabulary-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span> <span class="o">=</span> <span class="n">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary-226"><a href="#Vocabulary-226"><span class="linenos">226</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary-227"><a href="#Vocabulary-227"><span class="linenos">227</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary-228"><a href="#Vocabulary-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vocabulary-229"><a href="#Vocabulary-229"><span class="linenos">229</span></a>        <span class="c1"># Made an empty vocabulary, now extend it.</span>
</span><span id="Vocabulary-230"><a href="#Vocabulary-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span>
</span><span id="Vocabulary-231"><a href="#Vocabulary-231"><span class="linenos">231</span></a>                     <span class="n">min_count</span><span class="p">,</span>
</span><span id="Vocabulary-232"><a href="#Vocabulary-232"><span class="linenos">232</span></a>                     <span class="n">max_vocab_size</span><span class="p">,</span>
</span><span id="Vocabulary-233"><a href="#Vocabulary-233"><span class="linenos">233</span></a>                     <span class="n">non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary-234"><a href="#Vocabulary-234"><span class="linenos">234</span></a>                     <span class="n">pretrained_files</span><span class="p">,</span>
</span><span id="Vocabulary-235"><a href="#Vocabulary-235"><span class="linenos">235</span></a>                     <span class="n">only_include_pretrained_words</span><span class="p">,</span>
</span><span id="Vocabulary-236"><a href="#Vocabulary-236"><span class="linenos">236</span></a>                     <span class="n">tokens_to_add</span><span class="p">,</span>
</span><span id="Vocabulary-237"><a href="#Vocabulary-237"><span class="linenos">237</span></a>                     <span class="n">min_pretrained_embeddings</span><span class="p">)</span>
</span><span id="Vocabulary-238"><a href="#Vocabulary-238"><span class="linenos">238</span></a>
</span><span id="Vocabulary-239"><a href="#Vocabulary-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Vocabulary-240"><a href="#Vocabulary-240"><span class="linenos">240</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-241"><a href="#Vocabulary-241"><span class="linenos">241</span></a><span class="sd">        Need to sanitize defaultdict and defaultdict-like objects</span>
</span><span id="Vocabulary-242"><a href="#Vocabulary-242"><span class="linenos">242</span></a><span class="sd">        by converting them to vanilla dicts when we pickle the vocabulary.</span>
</span><span id="Vocabulary-243"><a href="#Vocabulary-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-244"><a href="#Vocabulary-244"><span class="linenos">244</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
</span><span id="Vocabulary-245"><a href="#Vocabulary-245"><span class="linenos">245</span></a>        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">])</span>
</span><span id="Vocabulary-246"><a href="#Vocabulary-246"><span class="linenos">246</span></a>        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">])</span>
</span><span id="Vocabulary-247"><a href="#Vocabulary-247"><span class="linenos">247</span></a>
</span><span id="Vocabulary-248"><a href="#Vocabulary-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="s2">&quot;_retained_counter&quot;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
</span><span id="Vocabulary-249"><a href="#Vocabulary-249"><span class="linenos">249</span></a>            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_retained_counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Vocabulary-250"><a href="#Vocabulary-250"><span class="linenos">250</span></a>                                          <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;_retained_counter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="Vocabulary-251"><a href="#Vocabulary-251"><span class="linenos">251</span></a>
</span><span id="Vocabulary-252"><a href="#Vocabulary-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">state</span>
</span><span id="Vocabulary-253"><a href="#Vocabulary-253"><span class="linenos">253</span></a>
</span><span id="Vocabulary-254"><a href="#Vocabulary-254"><span class="linenos">254</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
</span><span id="Vocabulary-255"><a href="#Vocabulary-255"><span class="linenos">255</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-256"><a href="#Vocabulary-256"><span class="linenos">256</span></a><span class="sd">        Conversely, when we unpickle, we need to reload the plain dicts</span>
</span><span id="Vocabulary-257"><a href="#Vocabulary-257"><span class="linenos">257</span></a><span class="sd">        into our special DefaultDict subclasses.</span>
</span><span id="Vocabulary-258"><a href="#Vocabulary-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-259"><a href="#Vocabulary-259"><span class="linenos">259</span></a>        <span class="c1"># pylint: disable=attribute-defined-outside-init</span>
</span><span id="Vocabulary-260"><a href="#Vocabulary-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="Vocabulary-261"><a href="#Vocabulary-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span> <span class="o">=</span> <span class="n">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary-262"><a href="#Vocabulary-262"><span class="linenos">262</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary-263"><a href="#Vocabulary-263"><span class="linenos">263</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary-264"><a href="#Vocabulary-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_token_to_index&quot;</span><span class="p">])</span>
</span><span id="Vocabulary-265"><a href="#Vocabulary-265"><span class="linenos">265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span> <span class="o">=</span> <span class="n">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary-266"><a href="#Vocabulary-266"><span class="linenos">266</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary-267"><a href="#Vocabulary-267"><span class="linenos">267</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary-268"><a href="#Vocabulary-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;_index_to_token&quot;</span><span class="p">])</span>
</span><span id="Vocabulary-269"><a href="#Vocabulary-269"><span class="linenos">269</span></a>
</span><span id="Vocabulary-270"><a href="#Vocabulary-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="nf">save_to_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary-271"><a href="#Vocabulary-271"><span class="linenos">271</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-272"><a href="#Vocabulary-272"><span class="linenos">272</span></a><span class="sd">        Persist this Vocabulary to files so it can be reloaded later.</span>
</span><span id="Vocabulary-273"><a href="#Vocabulary-273"><span class="linenos">273</span></a><span class="sd">        Each namespace corresponds to one file.</span>
</span><span id="Vocabulary-274"><a href="#Vocabulary-274"><span class="linenos">274</span></a>
</span><span id="Vocabulary-275"><a href="#Vocabulary-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary-276"><a href="#Vocabulary-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary-277"><a href="#Vocabulary-277"><span class="linenos">277</span></a><span class="sd">        directory : ``str``</span>
</span><span id="Vocabulary-278"><a href="#Vocabulary-278"><span class="linenos">278</span></a><span class="sd">            The directory where we save the serialized vocabulary.</span>
</span><span id="Vocabulary-279"><a href="#Vocabulary-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-280"><a href="#Vocabulary-280"><span class="linenos">280</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary-281"><a href="#Vocabulary-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary-282"><a href="#Vocabulary-282"><span class="linenos">282</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;vocabulary serialization directory </span><span class="si">%s</span><span class="s2"> is not empty&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary-283"><a href="#Vocabulary-283"><span class="linenos">283</span></a>
</span><span id="Vocabulary-284"><a href="#Vocabulary-284"><span class="linenos">284</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="Vocabulary-285"><a href="#Vocabulary-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">:</span>
</span><span id="Vocabulary-286"><a href="#Vocabulary-286"><span class="linenos">286</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">namespace_str</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">namespace_file</span><span class="p">)</span>
</span><span id="Vocabulary-287"><a href="#Vocabulary-287"><span class="linenos">287</span></a>
</span><span id="Vocabulary-288"><a href="#Vocabulary-288"><span class="linenos">288</span></a>        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Vocabulary-289"><a href="#Vocabulary-289"><span class="linenos">289</span></a>            <span class="c1"># Each namespace gets written to its own file, in index order.</span>
</span><span id="Vocabulary-290"><a href="#Vocabulary-290"><span class="linenos">290</span></a>            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">token_file</span><span class="p">:</span>
</span><span id="Vocabulary-291"><a href="#Vocabulary-291"><span class="linenos">291</span></a>                <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
</span><span id="Vocabulary-292"><a href="#Vocabulary-292"><span class="linenos">292</span></a>                <span class="n">start_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Vocabulary-293"><a href="#Vocabulary-293"><span class="linenos">293</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">num_tokens</span><span class="p">):</span>
</span><span id="Vocabulary-294"><a href="#Vocabulary-294"><span class="linenos">294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">token_file</span><span class="p">)</span>
</span><span id="Vocabulary-295"><a href="#Vocabulary-295"><span class="linenos">295</span></a>
</span><span id="Vocabulary-296"><a href="#Vocabulary-296"><span class="linenos">296</span></a>    <span class="nd">@classmethod</span>
</span><span id="Vocabulary-297"><a href="#Vocabulary-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vocabulary&#39;</span><span class="p">:</span>
</span><span id="Vocabulary-298"><a href="#Vocabulary-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-299"><a href="#Vocabulary-299"><span class="linenos">299</span></a><span class="sd">        Loads a ``Vocabulary`` that was serialized using ``save_to_files``.</span>
</span><span id="Vocabulary-300"><a href="#Vocabulary-300"><span class="linenos">300</span></a>
</span><span id="Vocabulary-301"><a href="#Vocabulary-301"><span class="linenos">301</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary-302"><a href="#Vocabulary-302"><span class="linenos">302</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary-303"><a href="#Vocabulary-303"><span class="linenos">303</span></a><span class="sd">        directory : ``str``</span>
</span><span id="Vocabulary-304"><a href="#Vocabulary-304"><span class="linenos">304</span></a><span class="sd">            The directory containing the serialized vocabulary.</span>
</span><span id="Vocabulary-305"><a href="#Vocabulary-305"><span class="linenos">305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-306"><a href="#Vocabulary-306"><span class="linenos">306</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="Vocabulary-307"><a href="#Vocabulary-307"><span class="linenos">307</span></a>        <span class="kn">import</span> <span class="nn">tempfile</span>
</span><span id="Vocabulary-308"><a href="#Vocabulary-308"><span class="linenos">308</span></a>        <span class="kn">import</span> <span class="nn">tarfile</span>
</span><span id="Vocabulary-309"><a href="#Vocabulary-309"><span class="linenos">309</span></a>        <span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="Vocabulary-310"><a href="#Vocabulary-310"><span class="linenos">310</span></a>        <span class="kn">import</span> <span class="nn">atexit</span>
</span><span id="Vocabulary-311"><a href="#Vocabulary-311"><span class="linenos">311</span></a>
</span><span id="Vocabulary-312"><a href="#Vocabulary-312"><span class="linenos">312</span></a>        <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vocabulary-313"><a href="#Vocabulary-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="Vocabulary-314"><a href="#Vocabulary-314"><span class="linenos">314</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;removing temporary unarchived model dir at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="Vocabulary-315"><a href="#Vocabulary-315"><span class="linenos">315</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="Vocabulary-316"><a href="#Vocabulary-316"><span class="linenos">316</span></a>
</span><span id="Vocabulary-317"><a href="#Vocabulary-317"><span class="linenos">317</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading token dictionary from </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary-318"><a href="#Vocabulary-318"><span class="linenos">318</span></a>
</span><span id="Vocabulary-319"><a href="#Vocabulary-319"><span class="linenos">319</span></a>        <span class="c1"># download and decompress if needed</span>
</span><span id="Vocabulary-320"><a href="#Vocabulary-320"><span class="linenos">320</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">cached_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary-321"><a href="#Vocabulary-321"><span class="linenos">321</span></a>
</span><span id="Vocabulary-322"><a href="#Vocabulary-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary-323"><a href="#Vocabulary-323"><span class="linenos">323</span></a>            <span class="k">pass</span>
</span><span id="Vocabulary-324"><a href="#Vocabulary-324"><span class="linenos">324</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-325"><a href="#Vocabulary-325"><span class="linenos">325</span></a>            <span class="c1"># Extract to temp dir</span>
</span><span id="Vocabulary-326"><a href="#Vocabulary-326"><span class="linenos">326</span></a>            <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
</span><span id="Vocabulary-327"><a href="#Vocabulary-327"><span class="linenos">327</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extracting file </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> to temp dir </span><span class="si">{</span><span class="n">tempdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-328"><a href="#Vocabulary-328"><span class="linenos">328</span></a>            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;r:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">archive</span><span class="p">:</span>
</span><span id="Vocabulary-329"><a href="#Vocabulary-329"><span class="linenos">329</span></a>                <span class="n">archive</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</span><span id="Vocabulary-330"><a href="#Vocabulary-330"><span class="linenos">330</span></a>            <span class="c1"># Postpone cleanup until exit in case the unarchived contents are needed outside</span>
</span><span id="Vocabulary-331"><a href="#Vocabulary-331"><span class="linenos">331</span></a>            <span class="c1"># this function.</span>
</span><span id="Vocabulary-332"><a href="#Vocabulary-332"><span class="linenos">332</span></a>            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_cleanup</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
</span><span id="Vocabulary-333"><a href="#Vocabulary-333"><span class="linenos">333</span></a>            <span class="n">directory</span> <span class="o">=</span> <span class="n">tempdir</span>
</span><span id="Vocabulary-334"><a href="#Vocabulary-334"><span class="linenos">334</span></a>
</span><span id="Vocabulary-335"><a href="#Vocabulary-335"><span class="linenos">335</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="Vocabulary-336"><a href="#Vocabulary-336"><span class="linenos">336</span></a>            <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">namespace_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="n">namespace_file</span><span class="p">]</span>
</span><span id="Vocabulary-337"><a href="#Vocabulary-337"><span class="linenos">337</span></a>
</span><span id="Vocabulary-338"><a href="#Vocabulary-338"><span class="linenos">338</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="o">=</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-339"><a href="#Vocabulary-339"><span class="linenos">339</span></a>
</span><span id="Vocabulary-340"><a href="#Vocabulary-340"><span class="linenos">340</span></a>        <span class="c1"># Check every file in the directory.</span>
</span><span id="Vocabulary-341"><a href="#Vocabulary-341"><span class="linenos">341</span></a>        <span class="k">for</span> <span class="n">namespace_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary-342"><a href="#Vocabulary-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span> <span class="o">==</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">:</span>
</span><span id="Vocabulary-343"><a href="#Vocabulary-343"><span class="linenos">343</span></a>                <span class="k">continue</span>
</span><span id="Vocabulary-344"><a href="#Vocabulary-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="Vocabulary-345"><a href="#Vocabulary-345"><span class="linenos">345</span></a>                <span class="k">continue</span>
</span><span id="Vocabulary-346"><a href="#Vocabulary-346"><span class="linenos">346</span></a>            <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Vocabulary-347"><a href="#Vocabulary-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">non_padded_namespaces</span><span class="p">):</span>
</span><span id="Vocabulary-348"><a href="#Vocabulary-348"><span class="linenos">348</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vocabulary-349"><a href="#Vocabulary-349"><span class="linenos">349</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-350"><a href="#Vocabulary-350"><span class="linenos">350</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vocabulary-351"><a href="#Vocabulary-351"><span class="linenos">351</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace_filename</span><span class="p">)</span>
</span><span id="Vocabulary-352"><a href="#Vocabulary-352"><span class="linenos">352</span></a>            <span class="n">vocab</span><span class="o">.</span><span class="n">set_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">is_padded</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-353"><a href="#Vocabulary-353"><span class="linenos">353</span></a>
</span><span id="Vocabulary-354"><a href="#Vocabulary-354"><span class="linenos">354</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span><span id="Vocabulary-355"><a href="#Vocabulary-355"><span class="linenos">355</span></a>
</span><span id="Vocabulary-356"><a href="#Vocabulary-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="nf">set_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vocabulary-357"><a href="#Vocabulary-357"><span class="linenos">357</span></a>                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Vocabulary-358"><a href="#Vocabulary-358"><span class="linenos">358</span></a>                      <span class="n">is_padded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Vocabulary-359"><a href="#Vocabulary-359"><span class="linenos">359</span></a>                      <span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span><span class="p">,</span>
</span><span id="Vocabulary-360"><a href="#Vocabulary-360"><span class="linenos">360</span></a>                      <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tokens&quot;</span><span class="p">):</span>
</span><span id="Vocabulary-361"><a href="#Vocabulary-361"><span class="linenos">361</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-362"><a href="#Vocabulary-362"><span class="linenos">362</span></a><span class="sd">        If you already have a vocabulary file for a trained model somewhere, and you really want to</span>
</span><span id="Vocabulary-363"><a href="#Vocabulary-363"><span class="linenos">363</span></a><span class="sd">        use that vocabulary file instead of just setting the vocabulary from a dataset, for</span>
</span><span id="Vocabulary-364"><a href="#Vocabulary-364"><span class="linenos">364</span></a><span class="sd">        whatever reason, you can do that with this method.  You must specify the namespace to use,</span>
</span><span id="Vocabulary-365"><a href="#Vocabulary-365"><span class="linenos">365</span></a><span class="sd">        and we assume that you want to use padding and OOV tokens for this.</span>
</span><span id="Vocabulary-366"><a href="#Vocabulary-366"><span class="linenos">366</span></a>
</span><span id="Vocabulary-367"><a href="#Vocabulary-367"><span class="linenos">367</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary-368"><a href="#Vocabulary-368"><span class="linenos">368</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary-369"><a href="#Vocabulary-369"><span class="linenos">369</span></a><span class="sd">        filename : ``str``</span>
</span><span id="Vocabulary-370"><a href="#Vocabulary-370"><span class="linenos">370</span></a><span class="sd">            The file containing the vocabulary to load.  It should be formatted as one token per</span>
</span><span id="Vocabulary-371"><a href="#Vocabulary-371"><span class="linenos">371</span></a><span class="sd">            line, with nothing else in the line.  The index we assign to the token is the line</span>
</span><span id="Vocabulary-372"><a href="#Vocabulary-372"><span class="linenos">372</span></a><span class="sd">            number in the file (1-indexed if ``is_padded``, 0-indexed otherwise).  Note that this</span>
</span><span id="Vocabulary-373"><a href="#Vocabulary-373"><span class="linenos">373</span></a><span class="sd">            file should contain the OOV token string!</span>
</span><span id="Vocabulary-374"><a href="#Vocabulary-374"><span class="linenos">374</span></a><span class="sd">        is_padded : ``bool``, optional (default=True)</span>
</span><span id="Vocabulary-375"><a href="#Vocabulary-375"><span class="linenos">375</span></a><span class="sd">            Is this vocabulary padded?  For token / word / character vocabularies, this should be</span>
</span><span id="Vocabulary-376"><a href="#Vocabulary-376"><span class="linenos">376</span></a><span class="sd">            ``True``; while for tag or label vocabularies, this should typically be ``False``.  If</span>
</span><span id="Vocabulary-377"><a href="#Vocabulary-377"><span class="linenos">377</span></a><span class="sd">            ``True``, we add a padding token with index 0, and we enforce that the ``oov_token`` is</span>
</span><span id="Vocabulary-378"><a href="#Vocabulary-378"><span class="linenos">378</span></a><span class="sd">            present in the file.</span>
</span><span id="Vocabulary-379"><a href="#Vocabulary-379"><span class="linenos">379</span></a><span class="sd">        oov_token : ``str``, optional (default=DEFAULT_OOV_TOKEN)</span>
</span><span id="Vocabulary-380"><a href="#Vocabulary-380"><span class="linenos">380</span></a><span class="sd">            What token does this vocabulary use to represent out-of-vocabulary characters?  This</span>
</span><span id="Vocabulary-381"><a href="#Vocabulary-381"><span class="linenos">381</span></a><span class="sd">            must show up as a line in the vocabulary file.  When we find it, we replace</span>
</span><span id="Vocabulary-382"><a href="#Vocabulary-382"><span class="linenos">382</span></a><span class="sd">            ``oov_token`` with ``self._oov_token``, because we only use one OOV token across</span>
</span><span id="Vocabulary-383"><a href="#Vocabulary-383"><span class="linenos">383</span></a><span class="sd">            namespaces.</span>
</span><span id="Vocabulary-384"><a href="#Vocabulary-384"><span class="linenos">384</span></a><span class="sd">        namespace : ``str``, optional (default=&quot;tokens&quot;)</span>
</span><span id="Vocabulary-385"><a href="#Vocabulary-385"><span class="linenos">385</span></a><span class="sd">            What namespace should we overwrite with this vocab file?</span>
</span><span id="Vocabulary-386"><a href="#Vocabulary-386"><span class="linenos">386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-387"><a href="#Vocabulary-387"><span class="linenos">387</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="Vocabulary-388"><a href="#Vocabulary-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Vocabulary-389"><a href="#Vocabulary-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">}</span>
</span><span id="Vocabulary-390"><a href="#Vocabulary-390"><span class="linenos">390</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-391"><a href="#Vocabulary-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Vocabulary-392"><a href="#Vocabulary-392"><span class="linenos">392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Vocabulary-393"><a href="#Vocabulary-393"><span class="linenos">393</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
</span><span id="Vocabulary-394"><a href="#Vocabulary-394"><span class="linenos">394</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Vocabulary-395"><a href="#Vocabulary-395"><span class="linenos">395</span></a>            <span class="c1"># Be flexible about having final newline or not</span>
</span><span id="Vocabulary-396"><a href="#Vocabulary-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Vocabulary-397"><a href="#Vocabulary-397"><span class="linenos">397</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Vocabulary-398"><a href="#Vocabulary-398"><span class="linenos">398</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="Vocabulary-399"><a href="#Vocabulary-399"><span class="linenos">399</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_padded</span> <span class="k">else</span> <span class="n">i</span>
</span><span id="Vocabulary-400"><a href="#Vocabulary-400"><span class="linenos">400</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Vocabulary-401"><a href="#Vocabulary-401"><span class="linenos">401</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">oov_token</span><span class="p">:</span>
</span><span id="Vocabulary-402"><a href="#Vocabulary-402"><span class="linenos">402</span></a>                    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span>
</span><span id="Vocabulary-403"><a href="#Vocabulary-403"><span class="linenos">403</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="Vocabulary-404"><a href="#Vocabulary-404"><span class="linenos">404</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="Vocabulary-405"><a href="#Vocabulary-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="Vocabulary-406"><a href="#Vocabulary-406"><span class="linenos">406</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">],</span> <span class="s2">&quot;OOV token not found!&quot;</span>
</span><span id="Vocabulary-407"><a href="#Vocabulary-407"><span class="linenos">407</span></a>   
</span><span id="Vocabulary-408"><a href="#Vocabulary-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vocabulary-409"><a href="#Vocabulary-409"><span class="linenos">409</span></a>                <span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-410"><a href="#Vocabulary-410"><span class="linenos">410</span></a>                <span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-411"><a href="#Vocabulary-411"><span class="linenos">411</span></a>                <span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-412"><a href="#Vocabulary-412"><span class="linenos">412</span></a>                <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NON_PADDED_NAMESPACES</span><span class="p">,</span>
</span><span id="Vocabulary-413"><a href="#Vocabulary-413"><span class="linenos">413</span></a>                <span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-414"><a href="#Vocabulary-414"><span class="linenos">414</span></a>                <span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Vocabulary-415"><a href="#Vocabulary-415"><span class="linenos">415</span></a>                <span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary-416"><a href="#Vocabulary-416"><span class="linenos">416</span></a>                <span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary-417"><a href="#Vocabulary-417"><span class="linenos">417</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-418"><a href="#Vocabulary-418"><span class="linenos">418</span></a><span class="sd">        This method can be used for extending already generated vocabulary.</span>
</span><span id="Vocabulary-419"><a href="#Vocabulary-419"><span class="linenos">419</span></a><span class="sd">        It takes same parameters as Vocabulary initializer. The token2index</span>
</span><span id="Vocabulary-420"><a href="#Vocabulary-420"><span class="linenos">420</span></a><span class="sd">        and indextotoken mappings of calling vocabulary will be retained.</span>
</span><span id="Vocabulary-421"><a href="#Vocabulary-421"><span class="linenos">421</span></a><span class="sd">        It is an inplace operation so None will be returned.</span>
</span><span id="Vocabulary-422"><a href="#Vocabulary-422"><span class="linenos">422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-423"><a href="#Vocabulary-423"><span class="linenos">423</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_vocab_size</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="Vocabulary-424"><a href="#Vocabulary-424"><span class="linenos">424</span></a>            <span class="n">int_max_vocab_size</span> <span class="o">=</span> <span class="n">max_vocab_size</span>
</span><span id="Vocabulary-425"><a href="#Vocabulary-425"><span class="linenos">425</span></a>            <span class="n">max_vocab_size</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">int_max_vocab_size</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Vocabulary-426"><a href="#Vocabulary-426"><span class="linenos">426</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="n">min_count</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Vocabulary-427"><a href="#Vocabulary-427"><span class="linenos">427</span></a>        <span class="n">pretrained_files</span> <span class="o">=</span> <span class="n">pretrained_files</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Vocabulary-428"><a href="#Vocabulary-428"><span class="linenos">428</span></a>        <span class="n">min_pretrained_embeddings</span> <span class="o">=</span> <span class="n">min_pretrained_embeddings</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Vocabulary-429"><a href="#Vocabulary-429"><span class="linenos">429</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-430"><a href="#Vocabulary-430"><span class="linenos">430</span></a>        <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Vocabulary-431"><a href="#Vocabulary-431"><span class="linenos">431</span></a>        <span class="n">tokens_to_add</span> <span class="o">=</span> <span class="n">tokens_to_add</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="Vocabulary-432"><a href="#Vocabulary-432"><span class="linenos">432</span></a>
</span><span id="Vocabulary-433"><a href="#Vocabulary-433"><span class="linenos">433</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span> <span class="o">=</span> <span class="n">counter</span>
</span><span id="Vocabulary-434"><a href="#Vocabulary-434"><span class="linenos">434</span></a>        <span class="c1"># Make sure vocabulary extension is safe.</span>
</span><span id="Vocabulary-435"><a href="#Vocabulary-435"><span class="linenos">435</span></a>        <span class="n">current_namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">}</span>
</span><span id="Vocabulary-436"><a href="#Vocabulary-436"><span class="linenos">436</span></a>        <span class="n">extension_namespaces</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">counter</span><span class="p">,</span> <span class="o">*</span><span class="n">tokens_to_add</span><span class="p">}</span>
</span><span id="Vocabulary-437"><a href="#Vocabulary-437"><span class="linenos">437</span></a>
</span><span id="Vocabulary-438"><a href="#Vocabulary-438"><span class="linenos">438</span></a>        <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">current_namespaces</span> <span class="o">&amp;</span> <span class="n">extension_namespaces</span><span class="p">:</span>
</span><span id="Vocabulary-439"><a href="#Vocabulary-439"><span class="linenos">439</span></a>            <span class="c1"># if new namespace was already present</span>
</span><span id="Vocabulary-440"><a href="#Vocabulary-440"><span class="linenos">440</span></a>            <span class="c1"># Either both should be padded or none should be.</span>
</span><span id="Vocabulary-441"><a href="#Vocabulary-441"><span class="linenos">441</span></a>            <span class="n">original_padded</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-442"><a href="#Vocabulary-442"><span class="linenos">442</span></a>                                      <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-443"><a href="#Vocabulary-443"><span class="linenos">443</span></a>            <span class="n">extension_padded</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-444"><a href="#Vocabulary-444"><span class="linenos">444</span></a>                                       <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-445"><a href="#Vocabulary-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="n">original_padded</span> <span class="o">!=</span> <span class="n">extension_padded</span><span class="p">:</span>
</span><span id="Vocabulary-446"><a href="#Vocabulary-446"><span class="linenos">446</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Common namespace </span><span class="si">{}</span><span class="s2"> has conflicting &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">+</span>
</span><span id="Vocabulary-447"><a href="#Vocabulary-447"><span class="linenos">447</span></a>                                         <span class="s2">&quot;setting of padded = True/False. &quot;</span><span class="o">+</span>
</span><span id="Vocabulary-448"><a href="#Vocabulary-448"><span class="linenos">448</span></a>                                         <span class="s2">&quot;Hence extension cannot be done.&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-449"><a href="#Vocabulary-449"><span class="linenos">449</span></a>
</span><span id="Vocabulary-450"><a href="#Vocabulary-450"><span class="linenos">450</span></a>        <span class="c1"># Add new non-padded namespaces for extension</span>
</span><span id="Vocabulary-451"><a href="#Vocabulary-451"><span class="linenos">451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="o">.</span><span class="n">add_non_padded_namespaces</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-452"><a href="#Vocabulary-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">add_non_padded_namespaces</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-453"><a href="#Vocabulary-453"><span class="linenos">453</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-454"><a href="#Vocabulary-454"><span class="linenos">454</span></a>
</span><span id="Vocabulary-455"><a href="#Vocabulary-455"><span class="linenos">455</span></a>        <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">counter</span><span class="p">:</span>
</span><span id="Vocabulary-456"><a href="#Vocabulary-456"><span class="linenos">456</span></a>            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="n">pretrained_files</span><span class="p">:</span>
</span><span id="Vocabulary-457"><a href="#Vocabulary-457"><span class="linenos">457</span></a>                <span class="n">pretrained_list</span> <span class="o">=</span> <span class="n">_read_pretrained_tokens</span><span class="p">(</span><span class="n">pretrained_files</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="Vocabulary-458"><a href="#Vocabulary-458"><span class="linenos">458</span></a>                <span class="n">min_embeddings</span> <span class="o">=</span> <span class="n">min_pretrained_embeddings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Vocabulary-459"><a href="#Vocabulary-459"><span class="linenos">459</span></a>                <span class="k">if</span> <span class="n">min_embeddings</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Vocabulary-460"><a href="#Vocabulary-460"><span class="linenos">460</span></a>                    <span class="n">tokens_old</span> <span class="o">=</span> <span class="n">tokens_to_add</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="Vocabulary-461"><a href="#Vocabulary-461"><span class="linenos">461</span></a>                    <span class="n">tokens_new</span> <span class="o">=</span> <span class="n">pretrained_list</span><span class="p">[:</span><span class="n">min_embeddings</span><span class="p">]</span>
</span><span id="Vocabulary-462"><a href="#Vocabulary-462"><span class="linenos">462</span></a>                    <span class="n">tokens_to_add</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens_old</span> <span class="o">+</span> <span class="n">tokens_new</span>
</span><span id="Vocabulary-463"><a href="#Vocabulary-463"><span class="linenos">463</span></a>                <span class="n">pretrained_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">pretrained_list</span><span class="p">)</span>
</span><span id="Vocabulary-464"><a href="#Vocabulary-464"><span class="linenos">464</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-465"><a href="#Vocabulary-465"><span class="linenos">465</span></a>                <span class="n">pretrained_set</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vocabulary-466"><a href="#Vocabulary-466"><span class="linenos">466</span></a>            <span class="n">token_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Vocabulary-467"><a href="#Vocabulary-467"><span class="linenos">467</span></a>            <span class="n">token_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary-468"><a href="#Vocabulary-468"><span class="linenos">468</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Vocabulary-469"><a href="#Vocabulary-469"><span class="linenos">469</span></a>                <span class="n">max_vocab</span> <span class="o">=</span> <span class="n">max_vocab_size</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="Vocabulary-470"><a href="#Vocabulary-470"><span class="linenos">470</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="Vocabulary-471"><a href="#Vocabulary-471"><span class="linenos">471</span></a>                <span class="n">max_vocab</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vocabulary-472"><a href="#Vocabulary-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">max_vocab</span><span class="p">:</span>
</span><span id="Vocabulary-473"><a href="#Vocabulary-473"><span class="linenos">473</span></a>                <span class="n">token_counts</span> <span class="o">=</span> <span class="n">token_counts</span><span class="p">[:</span><span class="n">max_vocab</span><span class="p">]</span>
</span><span id="Vocabulary-474"><a href="#Vocabulary-474"><span class="linenos">474</span></a>            <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">token_counts</span><span class="p">:</span>
</span><span id="Vocabulary-475"><a href="#Vocabulary-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">pretrained_set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary-476"><a href="#Vocabulary-476"><span class="linenos">476</span></a>                    <span class="k">if</span> <span class="n">only_include_pretrained_words</span><span class="p">:</span>
</span><span id="Vocabulary-477"><a href="#Vocabulary-477"><span class="linenos">477</span></a>                        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">pretrained_set</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Vocabulary-478"><a href="#Vocabulary-478"><span class="linenos">478</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-479"><a href="#Vocabulary-479"><span class="linenos">479</span></a>                    <span class="k">elif</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">pretrained_set</span> <span class="ow">or</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Vocabulary-480"><a href="#Vocabulary-480"><span class="linenos">480</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-481"><a href="#Vocabulary-481"><span class="linenos">481</span></a>                <span class="k">elif</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">min_count</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Vocabulary-482"><a href="#Vocabulary-482"><span class="linenos">482</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-483"><a href="#Vocabulary-483"><span class="linenos">483</span></a>
</span><span id="Vocabulary-484"><a href="#Vocabulary-484"><span class="linenos">484</span></a>        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">tokens</span> <span class="ow">in</span> <span class="n">tokens_to_add</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Vocabulary-485"><a href="#Vocabulary-485"><span class="linenos">485</span></a>            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
</span><span id="Vocabulary-486"><a href="#Vocabulary-486"><span class="linenos">486</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">add_token_to_namespace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-487"><a href="#Vocabulary-487"><span class="linenos">487</span></a>
</span><span id="Vocabulary-488"><a href="#Vocabulary-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">is_padded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vocabulary-489"><a href="#Vocabulary-489"><span class="linenos">489</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-490"><a href="#Vocabulary-490"><span class="linenos">490</span></a><span class="sd">        Returns whether or not there are padding and OOV tokens added to the given namespace.</span>
</span><span id="Vocabulary-491"><a href="#Vocabulary-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-492"><a href="#Vocabulary-492"><span class="linenos">492</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span>
</span><span id="Vocabulary-493"><a href="#Vocabulary-493"><span class="linenos">493</span></a>
</span><span id="Vocabulary-494"><a href="#Vocabulary-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">add_token_to_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary-495"><a href="#Vocabulary-495"><span class="linenos">495</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary-496"><a href="#Vocabulary-496"><span class="linenos">496</span></a><span class="sd">        Adds ``token`` to the index, if it is not already present.  Either way, we return the index of</span>
</span><span id="Vocabulary-497"><a href="#Vocabulary-497"><span class="linenos">497</span></a><span class="sd">        the token.</span>
</span><span id="Vocabulary-498"><a href="#Vocabulary-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary-499"><a href="#Vocabulary-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vocabulary-500"><a href="#Vocabulary-500"><span class="linenos">500</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vocabulary tokens must be strings, or saving and loading will break.&quot;</span>
</span><span id="Vocabulary-501"><a href="#Vocabulary-501"><span class="linenos">501</span></a>                             <span class="s2">&quot;  Got </span><span class="si">%s</span><span class="s2"> (with type </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">token</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">token</span><span class="p">)))</span>
</span><span id="Vocabulary-502"><a href="#Vocabulary-502"><span class="linenos">502</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="Vocabulary-503"><a href="#Vocabulary-503"><span class="linenos">503</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="Vocabulary-504"><a href="#Vocabulary-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="Vocabulary-505"><a href="#Vocabulary-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="Vocabulary-506"><a href="#Vocabulary-506"><span class="linenos">506</span></a>            <span class="k">return</span> <span class="n">index</span>
</span><span id="Vocabulary-507"><a href="#Vocabulary-507"><span class="linenos">507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-508"><a href="#Vocabulary-508"><span class="linenos">508</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span><span id="Vocabulary-509"><a href="#Vocabulary-509"><span class="linenos">509</span></a>
</span><span id="Vocabulary-510"><a href="#Vocabulary-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">get_index_to_token_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Vocabulary-511"><a href="#Vocabulary-511"><span class="linenos">511</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="Vocabulary-512"><a href="#Vocabulary-512"><span class="linenos">512</span></a>
</span><span id="Vocabulary-513"><a href="#Vocabulary-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">get_token_to_index_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Vocabulary-514"><a href="#Vocabulary-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span><span id="Vocabulary-515"><a href="#Vocabulary-515"><span class="linenos">515</span></a>
</span><span id="Vocabulary-516"><a href="#Vocabulary-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="nf">get_token_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary-517"><a href="#Vocabulary-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="Vocabulary-518"><a href="#Vocabulary-518"><span class="linenos">518</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span><span id="Vocabulary-519"><a href="#Vocabulary-519"><span class="linenos">519</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-520"><a href="#Vocabulary-520"><span class="linenos">520</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Vocabulary-521"><a href="#Vocabulary-521"><span class="linenos">521</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">]</span>
</span><span id="Vocabulary-522"><a href="#Vocabulary-522"><span class="linenos">522</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="Vocabulary-523"><a href="#Vocabulary-523"><span class="linenos">523</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Namespace: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary-524"><a href="#Vocabulary-524"><span class="linenos">524</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Token: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="Vocabulary-525"><a href="#Vocabulary-525"><span class="linenos">525</span></a>                <span class="k">raise</span>
</span><span id="Vocabulary-526"><a href="#Vocabulary-526"><span class="linenos">526</span></a>
</span><span id="Vocabulary-527"><a href="#Vocabulary-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">get_token_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vocabulary-528"><a href="#Vocabulary-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
</span><span id="Vocabulary-529"><a href="#Vocabulary-529"><span class="linenos">529</span></a>
</span><span id="Vocabulary-530"><a href="#Vocabulary-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">get_vocab_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary-531"><a href="#Vocabulary-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="Vocabulary-532"><a href="#Vocabulary-532"><span class="linenos">532</span></a>
</span><span id="Vocabulary-533"><a href="#Vocabulary-533"><span class="linenos">533</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Vocabulary-534"><a href="#Vocabulary-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="Vocabulary-535"><a href="#Vocabulary-535"><span class="linenos">535</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span>
</span><span id="Vocabulary-536"><a href="#Vocabulary-536"><span class="linenos">536</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Vocabulary-537"><a href="#Vocabulary-537"><span class="linenos">537</span></a>
</span><span id="Vocabulary-538"><a href="#Vocabulary-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vocabulary-539"><a href="#Vocabulary-539"><span class="linenos">539</span></a>        <span class="n">base_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary with namespaces:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Vocabulary-540"><a href="#Vocabulary-540"><span class="linenos">540</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Non Padded Namespaces: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Vocabulary-541"><a href="#Vocabulary-541"><span class="linenos">541</span></a>        <span class="n">namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Namespace: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vocab_size</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Vocabulary-542"><a href="#Vocabulary-542"><span class="linenos">542</span></a>                      <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">]</span>
</span><span id="Vocabulary-543"><a href="#Vocabulary-543"><span class="linenos">543</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_string</span><span class="p">,</span> <span class="n">non_padded_namespaces</span><span class="p">]</span> <span class="o">+</span> <span class="n">namespaces</span><span class="p">)</span>
</span><span id="Vocabulary-544"><a href="#Vocabulary-544"><span class="linenos">544</span></a>
</span><span id="Vocabulary-545"><a href="#Vocabulary-545"><span class="linenos">545</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vocabulary-546"><a href="#Vocabulary-546"><span class="linenos">546</span></a>        <span class="c1"># This is essentially the same as __str__, but with no newlines</span>
</span><span id="Vocabulary-547"><a href="#Vocabulary-547"><span class="linenos">547</span></a>        <span class="n">base_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vocabulary with namespaces: &quot;</span>
</span><span id="Vocabulary-548"><a href="#Vocabulary-548"><span class="linenos">548</span></a>        <span class="n">namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_vocab_size</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="si">}</span><span class="s2"> ||&quot;</span>
</span><span id="Vocabulary-549"><a href="#Vocabulary-549"><span class="linenos">549</span></a>                      <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">]</span>
</span><span id="Vocabulary-550"><a href="#Vocabulary-550"><span class="linenos">550</span></a>        <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Non Padded Namespaces: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Vocabulary-551"><a href="#Vocabulary-551"><span class="linenos">551</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">base_string</span><span class="p">]</span> <span class="o">+</span> <span class="n">namespaces</span> <span class="o">+</span> <span class="p">[</span><span class="n">non_padded_namespaces</span><span class="p">])</span>
</span><span id="Vocabulary-552"><a href="#Vocabulary-552"><span class="linenos">552</span></a>
</span><span id="Vocabulary-553"><a href="#Vocabulary-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">print_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary-554"><a href="#Vocabulary-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="Vocabulary-555"><a href="#Vocabulary-555"><span class="linenos">555</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Printed vocabulary statistics are only for the part of the vocabulary generated &quot;</span> \
</span><span id="Vocabulary-556"><a href="#Vocabulary-556"><span class="linenos">556</span></a>                        <span class="s2">&quot;from instances. If vocabulary is constructed by extending saved vocabulary with &quot;</span> \
</span><span id="Vocabulary-557"><a href="#Vocabulary-557"><span class="linenos">557</span></a>                        <span class="s2">&quot;dataset instances, the directly loaded portion won&#39;t be considered here.&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-558"><a href="#Vocabulary-558"><span class="linenos">558</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">----Vocabulary Statistics----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-559"><a href="#Vocabulary-559"><span class="linenos">559</span></a>            <span class="c1"># Since we don&#39;t saved counter info, it is impossible to consider pre-saved portion.</span>
</span><span id="Vocabulary-560"><a href="#Vocabulary-560"><span class="linenos">560</span></a>            <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="Vocabulary-561"><a href="#Vocabulary-561"><span class="linenos">561</span></a>                <span class="n">tokens_with_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Vocabulary-562"><a href="#Vocabulary-562"><span class="linenos">562</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary-563"><a href="#Vocabulary-563"><span class="linenos">563</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 most frequent tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-564"><a href="#Vocabulary-564"><span class="linenos">564</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="Vocabulary-565"><a href="#Vocabulary-565"><span class="linenos">565</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-566"><a href="#Vocabulary-566"><span class="linenos">566</span></a>                <span class="c1"># Now sort by token length, not frequency</span>
</span><span id="Vocabulary-567"><a href="#Vocabulary-567"><span class="linenos">567</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary-568"><a href="#Vocabulary-568"><span class="linenos">568</span></a>
</span><span id="Vocabulary-569"><a href="#Vocabulary-569"><span class="linenos">569</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 longest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-570"><a href="#Vocabulary-570"><span class="linenos">570</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="Vocabulary-571"><a href="#Vocabulary-571"><span class="linenos">571</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-572"><a href="#Vocabulary-572"><span class="linenos">572</span></a>
</span><span id="Vocabulary-573"><a href="#Vocabulary-573"><span class="linenos">573</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 shortest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-574"><a href="#Vocabulary-574"><span class="linenos">574</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tokens_with_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]):</span>
</span><span id="Vocabulary-575"><a href="#Vocabulary-575"><span class="linenos">575</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary-576"><a href="#Vocabulary-576"><span class="linenos">576</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary-577"><a href="#Vocabulary-577"><span class="linenos">577</span></a>            <span class="c1"># _retained_counter would be set only if instances were used for vocabulary construction.</span>
</span><span id="Vocabulary-578"><a href="#Vocabulary-578"><span class="linenos">578</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vocabulary statistics cannot be printed since &quot;</span> \
</span><span id="Vocabulary-579"><a href="#Vocabulary-579"><span class="linenos">579</span></a>                        <span class="s2">&quot;dataset instances were not used for its construction.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A Vocabulary maps strings to integers, allowing for strings to be mapped to an
out-of-vocabulary token.</p>

<p>Vocabularies are fit to a particular dataset, which we use to decide which tokens are
in-vocabulary.</p>

<p>Vocabularies also allow for several different namespaces, so you can have separate indices for
'a' as a word, and 'a' as a character, for instance, and so we can use this object to also map
tag and label strings to indices.  Most of the
methods on this class allow you to pass in a namespace; by default we use the 'tokens'
namespace, and you can omit the namespace argument everywhere and just use the default.</p>

<h2 id="parameters">Parameters</h2>

<p>counter : <code>Dict[str, Dict[str, int]]</code>, optional (default=<code>None</code>)
    A collection of counts from which to initialize this vocabulary.  We will examine the
    counts and, together with the other parameters to this class, use them to decide which
    words are in-vocabulary.  If this is <code>None</code>, we just won't initialize the vocabulary with
    anything.
min_count : <code>Dict[str, int]</code>, optional (default=None)
    When initializing the vocab from a counter, you can specify a minimum count, and every
    token with a count less than this will not be added to the dictionary.  These minimum
    counts are <code>namespace-specific</code>, so you can specify different minimums for labels versus
    words tokens, for example.  If a namespace does not have a key in the given dictionary, we
    will add all seen tokens to that namespace.
max_vocab_size : <code>Union[int, Dict[str, int]]</code>, optional (default=<code>None</code>)
    If you want to cap the number of tokens in your vocabulary, you can do so with this
    parameter.  If you specify a single integer, every namespace will have its vocabulary fixed
    to be no larger than this.  If you specify a dictionary, then each namespace in the
    <code>counter</code> can have a separate maximum vocabulary size.  Any missing key will have a value
    of <code>None</code>, which means no cap on the vocabulary size.
non_padded_namespaces : <code>Iterable[str]</code>, optional
    By default, we assume you are mapping word / character tokens to integers, and so you want
    to reserve word indices for padding and out-of-vocabulary tokens.  However, if you are
    mapping NER or SRL tags, or class labels, to integers, you probably do not want to reserve
    indices for padding and out-of-vocabulary tokens.  Use this field to specify which
    namespaces should <code>not</code> have padding and OOV tokens added.</p>

<pre><code>The format of each element of this is either a string, which must match field names
exactly,  or ``*`` followed by a string, which we match as a suffix against field names.

We try to make the default here reasonable, so that you don't have to think about this.
The default is ``("*tags", "*labels")``, so as long as your namespace ends in "tags" or
"labels" (which is true by default for all tag and label fields in this code), you don't
have to specify anything here.
</code></pre>

<p>pretrained_files : <code>Dict[str, str]</code>, optional
    If provided, this map specifies the path to optional pretrained embedding files for each
    namespace. This can be used to either restrict the vocabulary to only words which appear
    in this file, or to ensure that any words in this file are included in the vocabulary
    regardless of their count, depending on the value of <code>only_include_pretrained_words</code>.
    Words which appear in the pretrained embedding file but not in the data are NOT included
    in the Vocabulary.
min_pretrained_embeddings : <code>Dict[str, int]</code>, optional
    If provided, specifies for each namespace a minimum number of lines (typically the
    most common words) to keep from pretrained embedding files, even for words not
    appearing in the data.
only_include_pretrained_words : <code>bool</code>, optional (default=False)
    This defines the strategy for using any pretrained embedding files which may have been
    specified in <code>pretrained_files</code>. If False, an inclusive strategy is used: and words
    which are in the <code>counter</code> and in the pretrained file are added to the <code><a href="#Vocabulary">Vocabulary</a></code>,
    regardless of whether their count exceeds <code>min_count</code> or not. If True, we use an
    exclusive strategy: words are only included in the Vocabulary if they are in the pretrained
    embedding file (their count must still be at least <code>min_count</code>).
tokens_to_add : <code>Dict[str, List[str]]</code>, optional (default=None)
    If given, this is a list of tokens to add to the vocabulary, keyed by the namespace to add
    the tokens to.  This is a way to be sure that certain items appear in your vocabulary,
    regardless of any other vocabulary computation.</p>
</div>


                            <div id="Vocabulary.__init__" class="classattr">
                                        <input id="Vocabulary.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Vocabulary</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;*tags&#39;</span><span class="p">,</span> <span class="s1">&#39;*labels&#39;</span><span class="p">)</span>,</span><span class="param">	<span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Vocabulary.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.__init__-210"><a href="#Vocabulary.__init__-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-211"><a href="#Vocabulary.__init__-211"><span class="linenos">211</span></a>                 <span class="n">counter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-212"><a href="#Vocabulary.__init__-212"><span class="linenos">212</span></a>                 <span class="n">min_count</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-213"><a href="#Vocabulary.__init__-213"><span class="linenos">213</span></a>                 <span class="n">max_vocab_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-214"><a href="#Vocabulary.__init__-214"><span class="linenos">214</span></a>                 <span class="n">non_padded_namespaces</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEFAULT_NON_PADDED_NAMESPACES</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-215"><a href="#Vocabulary.__init__-215"><span class="linenos">215</span></a>                 <span class="n">pretrained_files</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-216"><a href="#Vocabulary.__init__-216"><span class="linenos">216</span></a>                 <span class="n">only_include_pretrained_words</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-217"><a href="#Vocabulary.__init__-217"><span class="linenos">217</span></a>                 <span class="n">tokens_to_add</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-218"><a href="#Vocabulary.__init__-218"><span class="linenos">218</span></a>                 <span class="n">min_pretrained_embeddings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary.__init__-219"><a href="#Vocabulary.__init__-219"><span class="linenos">219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="o">=</span> <span class="n">DEFAULT_PADDING_TOKEN</span>
</span><span id="Vocabulary.__init__-220"><a href="#Vocabulary.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span>
</span><span id="Vocabulary.__init__-221"><a href="#Vocabulary.__init__-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary.__init__-222"><a href="#Vocabulary.__init__-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span> <span class="o">=</span> <span class="n">_TokenToIndexDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-223"><a href="#Vocabulary.__init__-223"><span class="linenos">223</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-224"><a href="#Vocabulary.__init__-224"><span class="linenos">224</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary.__init__-225"><a href="#Vocabulary.__init__-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span> <span class="o">=</span> <span class="n">_IndexToTokenDefaultDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-226"><a href="#Vocabulary.__init__-226"><span class="linenos">226</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-227"><a href="#Vocabulary.__init__-227"><span class="linenos">227</span></a>                                                        <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">)</span>
</span><span id="Vocabulary.__init__-228"><a href="#Vocabulary.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vocabulary.__init__-229"><a href="#Vocabulary.__init__-229"><span class="linenos">229</span></a>        <span class="c1"># Made an empty vocabulary, now extend it.</span>
</span><span id="Vocabulary.__init__-230"><a href="#Vocabulary.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_extend</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-231"><a href="#Vocabulary.__init__-231"><span class="linenos">231</span></a>                     <span class="n">min_count</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-232"><a href="#Vocabulary.__init__-232"><span class="linenos">232</span></a>                     <span class="n">max_vocab_size</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-233"><a href="#Vocabulary.__init__-233"><span class="linenos">233</span></a>                     <span class="n">non_padded_namespaces</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-234"><a href="#Vocabulary.__init__-234"><span class="linenos">234</span></a>                     <span class="n">pretrained_files</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-235"><a href="#Vocabulary.__init__-235"><span class="linenos">235</span></a>                     <span class="n">only_include_pretrained_words</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-236"><a href="#Vocabulary.__init__-236"><span class="linenos">236</span></a>                     <span class="n">tokens_to_add</span><span class="p">,</span>
</span><span id="Vocabulary.__init__-237"><a href="#Vocabulary.__init__-237"><span class="linenos">237</span></a>                     <span class="n">min_pretrained_embeddings</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.default_implementation" class="classattr">
                                <div class="attr variable">
            <span class="name">default_implementation</span><span class="default_value"> = &#39;default&#39;</span>

        
    </div>
    <a class="headerlink" href="#Vocabulary.default_implementation"></a>
    
    

                            </div>
                            <div id="Vocabulary.save_to_files" class="classattr">
                                        <input id="Vocabulary.save_to_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_to_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.save_to_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.save_to_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.save_to_files-270"><a href="#Vocabulary.save_to_files-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="nf">save_to_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary.save_to_files-271"><a href="#Vocabulary.save_to_files-271"><span class="linenos">271</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary.save_to_files-272"><a href="#Vocabulary.save_to_files-272"><span class="linenos">272</span></a><span class="sd">        Persist this Vocabulary to files so it can be reloaded later.</span>
</span><span id="Vocabulary.save_to_files-273"><a href="#Vocabulary.save_to_files-273"><span class="linenos">273</span></a><span class="sd">        Each namespace corresponds to one file.</span>
</span><span id="Vocabulary.save_to_files-274"><a href="#Vocabulary.save_to_files-274"><span class="linenos">274</span></a>
</span><span id="Vocabulary.save_to_files-275"><a href="#Vocabulary.save_to_files-275"><span class="linenos">275</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary.save_to_files-276"><a href="#Vocabulary.save_to_files-276"><span class="linenos">276</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary.save_to_files-277"><a href="#Vocabulary.save_to_files-277"><span class="linenos">277</span></a><span class="sd">        directory : ``str``</span>
</span><span id="Vocabulary.save_to_files-278"><a href="#Vocabulary.save_to_files-278"><span class="linenos">278</span></a><span class="sd">            The directory where we save the serialized vocabulary.</span>
</span><span id="Vocabulary.save_to_files-279"><a href="#Vocabulary.save_to_files-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary.save_to_files-280"><a href="#Vocabulary.save_to_files-280"><span class="linenos">280</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary.save_to_files-281"><a href="#Vocabulary.save_to_files-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary.save_to_files-282"><a href="#Vocabulary.save_to_files-282"><span class="linenos">282</span></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;vocabulary serialization directory </span><span class="si">%s</span><span class="s2"> is not empty&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary.save_to_files-283"><a href="#Vocabulary.save_to_files-283"><span class="linenos">283</span></a>
</span><span id="Vocabulary.save_to_files-284"><a href="#Vocabulary.save_to_files-284"><span class="linenos">284</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="Vocabulary.save_to_files-285"><a href="#Vocabulary.save_to_files-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_non_padded_namespaces</span><span class="p">:</span>
</span><span id="Vocabulary.save_to_files-286"><a href="#Vocabulary.save_to_files-286"><span class="linenos">286</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">namespace_str</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">namespace_file</span><span class="p">)</span>
</span><span id="Vocabulary.save_to_files-287"><a href="#Vocabulary.save_to_files-287"><span class="linenos">287</span></a>
</span><span id="Vocabulary.save_to_files-288"><a href="#Vocabulary.save_to_files-288"><span class="linenos">288</span></a>        <span class="k">for</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Vocabulary.save_to_files-289"><a href="#Vocabulary.save_to_files-289"><span class="linenos">289</span></a>            <span class="c1"># Each namespace gets written to its own file, in index order.</span>
</span><span id="Vocabulary.save_to_files-290"><a href="#Vocabulary.save_to_files-290"><span class="linenos">290</span></a>            <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">token_file</span><span class="p">:</span>
</span><span id="Vocabulary.save_to_files-291"><a href="#Vocabulary.save_to_files-291"><span class="linenos">291</span></a>                <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
</span><span id="Vocabulary.save_to_files-292"><a href="#Vocabulary.save_to_files-292"><span class="linenos">292</span></a>                <span class="n">start_index</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">mapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Vocabulary.save_to_files-293"><a href="#Vocabulary.save_to_files-293"><span class="linenos">293</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">num_tokens</span><span class="p">):</span>
</span><span id="Vocabulary.save_to_files-294"><a href="#Vocabulary.save_to_files-294"><span class="linenos">294</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">token_file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Persist this Vocabulary to files so it can be reloaded later.
Each namespace corresponds to one file.</p>

<h2 id="parameters">Parameters</h2>

<p>directory : <code>str</code>
    The directory where we save the serialized vocabulary.</p>
</div>


                            </div>
                            <div id="Vocabulary.from_files" class="classattr">
                                        <input id="Vocabulary.from_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_files</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">directory</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vocabulary">canlpy.core.util.knowbert_tokenizer.vocabulary.Vocabulary</a></span>:</span></span>

                <label class="view-source-button" for="Vocabulary.from_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.from_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.from_files-296"><a href="#Vocabulary.from_files-296"><span class="linenos">296</span></a>    <span class="nd">@classmethod</span>
</span><span id="Vocabulary.from_files-297"><a href="#Vocabulary.from_files-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">from_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vocabulary&#39;</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-298"><a href="#Vocabulary.from_files-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary.from_files-299"><a href="#Vocabulary.from_files-299"><span class="linenos">299</span></a><span class="sd">        Loads a ``Vocabulary`` that was serialized using ``save_to_files``.</span>
</span><span id="Vocabulary.from_files-300"><a href="#Vocabulary.from_files-300"><span class="linenos">300</span></a>
</span><span id="Vocabulary.from_files-301"><a href="#Vocabulary.from_files-301"><span class="linenos">301</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary.from_files-302"><a href="#Vocabulary.from_files-302"><span class="linenos">302</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary.from_files-303"><a href="#Vocabulary.from_files-303"><span class="linenos">303</span></a><span class="sd">        directory : ``str``</span>
</span><span id="Vocabulary.from_files-304"><a href="#Vocabulary.from_files-304"><span class="linenos">304</span></a><span class="sd">            The directory containing the serialized vocabulary.</span>
</span><span id="Vocabulary.from_files-305"><a href="#Vocabulary.from_files-305"><span class="linenos">305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary.from_files-306"><a href="#Vocabulary.from_files-306"><span class="linenos">306</span></a>        <span class="kn">import</span> <span class="nn">os</span>
</span><span id="Vocabulary.from_files-307"><a href="#Vocabulary.from_files-307"><span class="linenos">307</span></a>        <span class="kn">import</span> <span class="nn">tempfile</span>
</span><span id="Vocabulary.from_files-308"><a href="#Vocabulary.from_files-308"><span class="linenos">308</span></a>        <span class="kn">import</span> <span class="nn">tarfile</span>
</span><span id="Vocabulary.from_files-309"><a href="#Vocabulary.from_files-309"><span class="linenos">309</span></a>        <span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="Vocabulary.from_files-310"><a href="#Vocabulary.from_files-310"><span class="linenos">310</span></a>        <span class="kn">import</span> <span class="nn">atexit</span>
</span><span id="Vocabulary.from_files-311"><a href="#Vocabulary.from_files-311"><span class="linenos">311</span></a>
</span><span id="Vocabulary.from_files-312"><a href="#Vocabulary.from_files-312"><span class="linenos">312</span></a>        <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-313"><a href="#Vocabulary.from_files-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-314"><a href="#Vocabulary.from_files-314"><span class="linenos">314</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;removing temporary unarchived model dir at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-315"><a href="#Vocabulary.from_files-315"><span class="linenos">315</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-316"><a href="#Vocabulary.from_files-316"><span class="linenos">316</span></a>
</span><span id="Vocabulary.from_files-317"><a href="#Vocabulary.from_files-317"><span class="linenos">317</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading token dictionary from </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-318"><a href="#Vocabulary.from_files-318"><span class="linenos">318</span></a>
</span><span id="Vocabulary.from_files-319"><a href="#Vocabulary.from_files-319"><span class="linenos">319</span></a>        <span class="c1"># download and decompress if needed</span>
</span><span id="Vocabulary.from_files-320"><a href="#Vocabulary.from_files-320"><span class="linenos">320</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">cached_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-321"><a href="#Vocabulary.from_files-321"><span class="linenos">321</span></a>
</span><span id="Vocabulary.from_files-322"><a href="#Vocabulary.from_files-322"><span class="linenos">322</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-323"><a href="#Vocabulary.from_files-323"><span class="linenos">323</span></a>            <span class="k">pass</span>
</span><span id="Vocabulary.from_files-324"><a href="#Vocabulary.from_files-324"><span class="linenos">324</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-325"><a href="#Vocabulary.from_files-325"><span class="linenos">325</span></a>            <span class="c1"># Extract to temp dir</span>
</span><span id="Vocabulary.from_files-326"><a href="#Vocabulary.from_files-326"><span class="linenos">326</span></a>            <span class="n">tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
</span><span id="Vocabulary.from_files-327"><a href="#Vocabulary.from_files-327"><span class="linenos">327</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;extracting file </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2"> to temp dir </span><span class="si">{</span><span class="n">tempdir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-328"><a href="#Vocabulary.from_files-328"><span class="linenos">328</span></a>            <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;r:gz&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">archive</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-329"><a href="#Vocabulary.from_files-329"><span class="linenos">329</span></a>                <span class="n">archive</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-330"><a href="#Vocabulary.from_files-330"><span class="linenos">330</span></a>            <span class="c1"># Postpone cleanup until exit in case the unarchived contents are needed outside</span>
</span><span id="Vocabulary.from_files-331"><a href="#Vocabulary.from_files-331"><span class="linenos">331</span></a>            <span class="c1"># this function.</span>
</span><span id="Vocabulary.from_files-332"><a href="#Vocabulary.from_files-332"><span class="linenos">332</span></a>            <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">_cleanup</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-333"><a href="#Vocabulary.from_files-333"><span class="linenos">333</span></a>            <span class="n">directory</span> <span class="o">=</span> <span class="n">tempdir</span>
</span><span id="Vocabulary.from_files-334"><a href="#Vocabulary.from_files-334"><span class="linenos">334</span></a>
</span><span id="Vocabulary.from_files-335"><a href="#Vocabulary.from_files-335"><span class="linenos">335</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">namespace_file</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-336"><a href="#Vocabulary.from_files-336"><span class="linenos">336</span></a>            <span class="n">non_padded_namespaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">namespace_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">namespace_str</span> <span class="ow">in</span> <span class="n">namespace_file</span><span class="p">]</span>
</span><span id="Vocabulary.from_files-337"><a href="#Vocabulary.from_files-337"><span class="linenos">337</span></a>
</span><span id="Vocabulary.from_files-338"><a href="#Vocabulary.from_files-338"><span class="linenos">338</span></a>        <span class="n">vocab</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">non_padded_namespaces</span><span class="o">=</span><span class="n">non_padded_namespaces</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-339"><a href="#Vocabulary.from_files-339"><span class="linenos">339</span></a>
</span><span id="Vocabulary.from_files-340"><a href="#Vocabulary.from_files-340"><span class="linenos">340</span></a>        <span class="c1"># Check every file in the directory.</span>
</span><span id="Vocabulary.from_files-341"><a href="#Vocabulary.from_files-341"><span class="linenos">341</span></a>        <span class="k">for</span> <span class="n">namespace_filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-342"><a href="#Vocabulary.from_files-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span> <span class="o">==</span> <span class="n">NAMESPACE_PADDING_FILE</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-343"><a href="#Vocabulary.from_files-343"><span class="linenos">343</span></a>                <span class="k">continue</span>
</span><span id="Vocabulary.from_files-344"><a href="#Vocabulary.from_files-344"><span class="linenos">344</span></a>            <span class="k">if</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-345"><a href="#Vocabulary.from_files-345"><span class="linenos">345</span></a>                <span class="k">continue</span>
</span><span id="Vocabulary.from_files-346"><a href="#Vocabulary.from_files-346"><span class="linenos">346</span></a>            <span class="n">namespace</span> <span class="o">=</span> <span class="n">namespace_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-347"><a href="#Vocabulary.from_files-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">namespace_match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">non_padded_namespaces</span><span class="p">):</span>
</span><span id="Vocabulary.from_files-348"><a href="#Vocabulary.from_files-348"><span class="linenos">348</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Vocabulary.from_files-349"><a href="#Vocabulary.from_files-349"><span class="linenos">349</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.from_files-350"><a href="#Vocabulary.from_files-350"><span class="linenos">350</span></a>                <span class="n">is_padded</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Vocabulary.from_files-351"><a href="#Vocabulary.from_files-351"><span class="linenos">351</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">namespace_filename</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-352"><a href="#Vocabulary.from_files-352"><span class="linenos">352</span></a>            <span class="n">vocab</span><span class="o">.</span><span class="n">set_from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">is_padded</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary.from_files-353"><a href="#Vocabulary.from_files-353"><span class="linenos">353</span></a>
</span><span id="Vocabulary.from_files-354"><a href="#Vocabulary.from_files-354"><span class="linenos">354</span></a>        <span class="k">return</span> <span class="n">vocab</span>
</span></pre></div>


            <div class="docstring"><p>Loads a <code><a href="#Vocabulary">Vocabulary</a></code> that was serialized using <code><a href="#Vocabulary.save_to_files">save_to_files</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<p>directory : <code>str</code>
    The directory containing the serialized vocabulary.</p>
</div>


                            </div>
                            <div id="Vocabulary.set_from_file" class="classattr">
                                        <input id="Vocabulary.set_from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_from_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">is_padded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;@@UNKNOWN@@&#39;</span>,</span><span class="param">	<span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span>)</span>

                <label class="view-source-button" for="Vocabulary.set_from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.set_from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.set_from_file-356"><a href="#Vocabulary.set_from_file-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="nf">set_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vocabulary.set_from_file-357"><a href="#Vocabulary.set_from_file-357"><span class="linenos">357</span></a>                      <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Vocabulary.set_from_file-358"><a href="#Vocabulary.set_from_file-358"><span class="linenos">358</span></a>                      <span class="n">is_padded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="Vocabulary.set_from_file-359"><a href="#Vocabulary.set_from_file-359"><span class="linenos">359</span></a>                      <span class="n">oov_token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_OOV_TOKEN</span><span class="p">,</span>
</span><span id="Vocabulary.set_from_file-360"><a href="#Vocabulary.set_from_file-360"><span class="linenos">360</span></a>                      <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tokens&quot;</span><span class="p">):</span>
</span><span id="Vocabulary.set_from_file-361"><a href="#Vocabulary.set_from_file-361"><span class="linenos">361</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary.set_from_file-362"><a href="#Vocabulary.set_from_file-362"><span class="linenos">362</span></a><span class="sd">        If you already have a vocabulary file for a trained model somewhere, and you really want to</span>
</span><span id="Vocabulary.set_from_file-363"><a href="#Vocabulary.set_from_file-363"><span class="linenos">363</span></a><span class="sd">        use that vocabulary file instead of just setting the vocabulary from a dataset, for</span>
</span><span id="Vocabulary.set_from_file-364"><a href="#Vocabulary.set_from_file-364"><span class="linenos">364</span></a><span class="sd">        whatever reason, you can do that with this method.  You must specify the namespace to use,</span>
</span><span id="Vocabulary.set_from_file-365"><a href="#Vocabulary.set_from_file-365"><span class="linenos">365</span></a><span class="sd">        and we assume that you want to use padding and OOV tokens for this.</span>
</span><span id="Vocabulary.set_from_file-366"><a href="#Vocabulary.set_from_file-366"><span class="linenos">366</span></a>
</span><span id="Vocabulary.set_from_file-367"><a href="#Vocabulary.set_from_file-367"><span class="linenos">367</span></a><span class="sd">        Parameters</span>
</span><span id="Vocabulary.set_from_file-368"><a href="#Vocabulary.set_from_file-368"><span class="linenos">368</span></a><span class="sd">        ----------</span>
</span><span id="Vocabulary.set_from_file-369"><a href="#Vocabulary.set_from_file-369"><span class="linenos">369</span></a><span class="sd">        filename : ``str``</span>
</span><span id="Vocabulary.set_from_file-370"><a href="#Vocabulary.set_from_file-370"><span class="linenos">370</span></a><span class="sd">            The file containing the vocabulary to load.  It should be formatted as one token per</span>
</span><span id="Vocabulary.set_from_file-371"><a href="#Vocabulary.set_from_file-371"><span class="linenos">371</span></a><span class="sd">            line, with nothing else in the line.  The index we assign to the token is the line</span>
</span><span id="Vocabulary.set_from_file-372"><a href="#Vocabulary.set_from_file-372"><span class="linenos">372</span></a><span class="sd">            number in the file (1-indexed if ``is_padded``, 0-indexed otherwise).  Note that this</span>
</span><span id="Vocabulary.set_from_file-373"><a href="#Vocabulary.set_from_file-373"><span class="linenos">373</span></a><span class="sd">            file should contain the OOV token string!</span>
</span><span id="Vocabulary.set_from_file-374"><a href="#Vocabulary.set_from_file-374"><span class="linenos">374</span></a><span class="sd">        is_padded : ``bool``, optional (default=True)</span>
</span><span id="Vocabulary.set_from_file-375"><a href="#Vocabulary.set_from_file-375"><span class="linenos">375</span></a><span class="sd">            Is this vocabulary padded?  For token / word / character vocabularies, this should be</span>
</span><span id="Vocabulary.set_from_file-376"><a href="#Vocabulary.set_from_file-376"><span class="linenos">376</span></a><span class="sd">            ``True``; while for tag or label vocabularies, this should typically be ``False``.  If</span>
</span><span id="Vocabulary.set_from_file-377"><a href="#Vocabulary.set_from_file-377"><span class="linenos">377</span></a><span class="sd">            ``True``, we add a padding token with index 0, and we enforce that the ``oov_token`` is</span>
</span><span id="Vocabulary.set_from_file-378"><a href="#Vocabulary.set_from_file-378"><span class="linenos">378</span></a><span class="sd">            present in the file.</span>
</span><span id="Vocabulary.set_from_file-379"><a href="#Vocabulary.set_from_file-379"><span class="linenos">379</span></a><span class="sd">        oov_token : ``str``, optional (default=DEFAULT_OOV_TOKEN)</span>
</span><span id="Vocabulary.set_from_file-380"><a href="#Vocabulary.set_from_file-380"><span class="linenos">380</span></a><span class="sd">            What token does this vocabulary use to represent out-of-vocabulary characters?  This</span>
</span><span id="Vocabulary.set_from_file-381"><a href="#Vocabulary.set_from_file-381"><span class="linenos">381</span></a><span class="sd">            must show up as a line in the vocabulary file.  When we find it, we replace</span>
</span><span id="Vocabulary.set_from_file-382"><a href="#Vocabulary.set_from_file-382"><span class="linenos">382</span></a><span class="sd">            ``oov_token`` with ``self._oov_token``, because we only use one OOV token across</span>
</span><span id="Vocabulary.set_from_file-383"><a href="#Vocabulary.set_from_file-383"><span class="linenos">383</span></a><span class="sd">            namespaces.</span>
</span><span id="Vocabulary.set_from_file-384"><a href="#Vocabulary.set_from_file-384"><span class="linenos">384</span></a><span class="sd">        namespace : ``str``, optional (default=&quot;tokens&quot;)</span>
</span><span id="Vocabulary.set_from_file-385"><a href="#Vocabulary.set_from_file-385"><span class="linenos">385</span></a><span class="sd">            What namespace should we overwrite with this vocab file?</span>
</span><span id="Vocabulary.set_from_file-386"><a href="#Vocabulary.set_from_file-386"><span class="linenos">386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary.set_from_file-387"><a href="#Vocabulary.set_from_file-387"><span class="linenos">387</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-388"><a href="#Vocabulary.set_from_file-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Vocabulary.set_from_file-389"><a href="#Vocabulary.set_from_file-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span><span class="p">}</span>
</span><span id="Vocabulary.set_from_file-390"><a href="#Vocabulary.set_from_file-390"><span class="linenos">390</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-391"><a href="#Vocabulary.set_from_file-391"><span class="linenos">391</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Vocabulary.set_from_file-392"><a href="#Vocabulary.set_from_file-392"><span class="linenos">392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Vocabulary.set_from_file-393"><a href="#Vocabulary.set_from_file-393"><span class="linenos">393</span></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-394"><a href="#Vocabulary.set_from_file-394"><span class="linenos">394</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Vocabulary.set_from_file-395"><a href="#Vocabulary.set_from_file-395"><span class="linenos">395</span></a>            <span class="c1"># Be flexible about having final newline or not</span>
</span><span id="Vocabulary.set_from_file-396"><a href="#Vocabulary.set_from_file-396"><span class="linenos">396</span></a>            <span class="k">if</span> <span class="n">lines</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-397"><a href="#Vocabulary.set_from_file-397"><span class="linenos">397</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Vocabulary.set_from_file-398"><a href="#Vocabulary.set_from_file-398"><span class="linenos">398</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="Vocabulary.set_from_file-399"><a href="#Vocabulary.set_from_file-399"><span class="linenos">399</span></a>                <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_padded</span> <span class="k">else</span> <span class="n">i</span>
</span><span id="Vocabulary.set_from_file-400"><a href="#Vocabulary.set_from_file-400"><span class="linenos">400</span></a>                <span class="n">token</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;@@NEWLINE@@&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Vocabulary.set_from_file-401"><a href="#Vocabulary.set_from_file-401"><span class="linenos">401</span></a>                <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="n">oov_token</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-402"><a href="#Vocabulary.set_from_file-402"><span class="linenos">402</span></a>                    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span>
</span><span id="Vocabulary.set_from_file-403"><a href="#Vocabulary.set_from_file-403"><span class="linenos">403</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="Vocabulary.set_from_file-404"><a href="#Vocabulary.set_from_file-404"><span class="linenos">404</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="Vocabulary.set_from_file-405"><a href="#Vocabulary.set_from_file-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="n">is_padded</span><span class="p">:</span>
</span><span id="Vocabulary.set_from_file-406"><a href="#Vocabulary.set_from_file-406"><span class="linenos">406</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">],</span> <span class="s2">&quot;OOV token not found!&quot;</span>
</span></pre></div>


            <div class="docstring"><p>If you already have a vocabulary file for a trained model somewhere, and you really want to
use that vocabulary file instead of just setting the vocabulary from a dataset, for
whatever reason, you can do that with this method.  You must specify the namespace to use,
and we assume that you want to use padding and OOV tokens for this.</p>

<h2 id="parameters">Parameters</h2>

<p>filename : <code>str</code>
    The file containing the vocabulary to load.  It should be formatted as one token per
    line, with nothing else in the line.  The index we assign to the token is the line
    number in the file (1-indexed if <code><a href="#Vocabulary.is_padded">is_padded</a></code>, 0-indexed otherwise).  Note that this
    file should contain the OOV token string!
is_padded : <code>bool</code>, optional (default=True)
    Is this vocabulary padded?  For token / word / character vocabularies, this should be
    <code>True</code>; while for tag or label vocabularies, this should typically be <code>False</code>.  If
    <code>True</code>, we add a padding token with index 0, and we enforce that the <code>oov_token</code> is
    present in the file.
oov_token : <code>str</code>, optional (default=DEFAULT_OOV_TOKEN)
    What token does this vocabulary use to represent out-of-vocabulary characters?  This
    must show up as a line in the vocabulary file.  When we find it, we replace
    <code>oov_token</code> with <code>self._oov_token</code>, because we only use one OOV token across
    namespaces.
namespace : <code>str</code>, optional (default="tokens")
    What namespace should we overwrite with this vocab file?</p>
</div>


                            </div>
                            <div id="Vocabulary.is_padded" class="classattr">
                                        <input id="Vocabulary.is_padded-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_padded</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.is_padded-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.is_padded"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.is_padded-488"><a href="#Vocabulary.is_padded-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">is_padded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vocabulary.is_padded-489"><a href="#Vocabulary.is_padded-489"><span class="linenos">489</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary.is_padded-490"><a href="#Vocabulary.is_padded-490"><span class="linenos">490</span></a><span class="sd">        Returns whether or not there are padding and OOV tokens added to the given namespace.</span>
</span><span id="Vocabulary.is_padded-491"><a href="#Vocabulary.is_padded-491"><span class="linenos">491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary.is_padded-492"><a href="#Vocabulary.is_padded-492"><span class="linenos">492</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_padding_token</span>
</span></pre></div>


            <div class="docstring"><p>Returns whether or not there are padding and OOV tokens added to the given namespace.</p>
</div>


                            </div>
                            <div id="Vocabulary.add_token_to_namespace" class="classattr">
                                        <input id="Vocabulary.add_token_to_namespace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_token_to_namespace</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">token</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.add_token_to_namespace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.add_token_to_namespace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.add_token_to_namespace-494"><a href="#Vocabulary.add_token_to_namespace-494"><span class="linenos">494</span></a>    <span class="k">def</span> <span class="nf">add_token_to_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary.add_token_to_namespace-495"><a href="#Vocabulary.add_token_to_namespace-495"><span class="linenos">495</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="Vocabulary.add_token_to_namespace-496"><a href="#Vocabulary.add_token_to_namespace-496"><span class="linenos">496</span></a><span class="sd">        Adds ``token`` to the index, if it is not already present.  Either way, we return the index of</span>
</span><span id="Vocabulary.add_token_to_namespace-497"><a href="#Vocabulary.add_token_to_namespace-497"><span class="linenos">497</span></a><span class="sd">        the token.</span>
</span><span id="Vocabulary.add_token_to_namespace-498"><a href="#Vocabulary.add_token_to_namespace-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vocabulary.add_token_to_namespace-499"><a href="#Vocabulary.add_token_to_namespace-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Vocabulary.add_token_to_namespace-500"><a href="#Vocabulary.add_token_to_namespace-500"><span class="linenos">500</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vocabulary tokens must be strings, or saving and loading will break.&quot;</span>
</span><span id="Vocabulary.add_token_to_namespace-501"><a href="#Vocabulary.add_token_to_namespace-501"><span class="linenos">501</span></a>                             <span class="s2">&quot;  Got </span><span class="si">%s</span><span class="s2"> (with type </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">token</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">token</span><span class="p">)))</span>
</span><span id="Vocabulary.add_token_to_namespace-502"><a href="#Vocabulary.add_token_to_namespace-502"><span class="linenos">502</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="Vocabulary.add_token_to_namespace-503"><a href="#Vocabulary.add_token_to_namespace-503"><span class="linenos">503</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span><span id="Vocabulary.add_token_to_namespace-504"><a href="#Vocabulary.add_token_to_namespace-504"><span class="linenos">504</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="Vocabulary.add_token_to_namespace-505"><a href="#Vocabulary.add_token_to_namespace-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="Vocabulary.add_token_to_namespace-506"><a href="#Vocabulary.add_token_to_namespace-506"><span class="linenos">506</span></a>            <span class="k">return</span> <span class="n">index</span>
</span><span id="Vocabulary.add_token_to_namespace-507"><a href="#Vocabulary.add_token_to_namespace-507"><span class="linenos">507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.add_token_to_namespace-508"><a href="#Vocabulary.add_token_to_namespace-508"><span class="linenos">508</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Adds <code>token</code> to the index, if it is not already present.  Either way, we return the index of
the token.</p>
</div>


                            </div>
                            <div id="Vocabulary.get_index_to_token_vocabulary" class="classattr">
                                        <input id="Vocabulary.get_index_to_token_vocabulary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_index_to_token_vocabulary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.get_index_to_token_vocabulary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.get_index_to_token_vocabulary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.get_index_to_token_vocabulary-510"><a href="#Vocabulary.get_index_to_token_vocabulary-510"><span class="linenos">510</span></a>    <span class="k">def</span> <span class="nf">get_index_to_token_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="Vocabulary.get_index_to_token_vocabulary-511"><a href="#Vocabulary.get_index_to_token_vocabulary-511"><span class="linenos">511</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.get_token_to_index_vocabulary" class="classattr">
                                        <input id="Vocabulary.get_token_to_index_vocabulary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_token_to_index_vocabulary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.get_token_to_index_vocabulary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.get_token_to_index_vocabulary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.get_token_to_index_vocabulary-513"><a href="#Vocabulary.get_token_to_index_vocabulary-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">get_token_to_index_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Vocabulary.get_token_to_index_vocabulary-514"><a href="#Vocabulary.get_token_to_index_vocabulary-514"><span class="linenos">514</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.get_token_index" class="classattr">
                                        <input id="Vocabulary.get_token_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_token_index</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">token</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.get_token_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.get_token_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.get_token_index-516"><a href="#Vocabulary.get_token_index-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="nf">get_token_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary.get_token_index-517"><a href="#Vocabulary.get_token_index-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
</span><span id="Vocabulary.get_token_index-518"><a href="#Vocabulary.get_token_index-518"><span class="linenos">518</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">token</span><span class="p">]</span>
</span><span id="Vocabulary.get_token_index-519"><a href="#Vocabulary.get_token_index-519"><span class="linenos">519</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.get_token_index-520"><a href="#Vocabulary.get_token_index-520"><span class="linenos">520</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Vocabulary.get_token_index-521"><a href="#Vocabulary.get_token_index-521"><span class="linenos">521</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_oov_token</span><span class="p">]</span>
</span><span id="Vocabulary.get_token_index-522"><a href="#Vocabulary.get_token_index-522"><span class="linenos">522</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="Vocabulary.get_token_index-523"><a href="#Vocabulary.get_token_index-523"><span class="linenos">523</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Namespace: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
</span><span id="Vocabulary.get_token_index-524"><a href="#Vocabulary.get_token_index-524"><span class="linenos">524</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Token: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
</span><span id="Vocabulary.get_token_index-525"><a href="#Vocabulary.get_token_index-525"><span class="linenos">525</span></a>                <span class="k">raise</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.get_token_from_index" class="classattr">
                                        <input id="Vocabulary.get_token_from_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_token_from_index</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">index</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.get_token_from_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.get_token_from_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.get_token_from_index-527"><a href="#Vocabulary.get_token_from_index-527"><span class="linenos">527</span></a>    <span class="k">def</span> <span class="nf">get_token_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vocabulary.get_token_from_index-528"><a href="#Vocabulary.get_token_from_index-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_to_token</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.get_vocab_size" class="classattr">
                                        <input id="Vocabulary.get_vocab_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_vocab_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.get_vocab_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.get_vocab_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.get_vocab_size-530"><a href="#Vocabulary.get_vocab_size-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">get_vocab_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tokens&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vocabulary.get_vocab_size-531"><a href="#Vocabulary.get_vocab_size-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_to_index</span><span class="p">[</span><span class="n">namespace</span><span class="p">])</span>
</span></pre></div>


    

                            </div>
                            <div id="Vocabulary.print_statistics" class="classattr">
                                        <input id="Vocabulary.print_statistics-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_statistics</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Vocabulary.print_statistics-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vocabulary.print_statistics"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vocabulary.print_statistics-553"><a href="#Vocabulary.print_statistics-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">print_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vocabulary.print_statistics-554"><a href="#Vocabulary.print_statistics-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="Vocabulary.print_statistics-555"><a href="#Vocabulary.print_statistics-555"><span class="linenos">555</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Printed vocabulary statistics are only for the part of the vocabulary generated &quot;</span> \
</span><span id="Vocabulary.print_statistics-556"><a href="#Vocabulary.print_statistics-556"><span class="linenos">556</span></a>                        <span class="s2">&quot;from instances. If vocabulary is constructed by extending saved vocabulary with &quot;</span> \
</span><span id="Vocabulary.print_statistics-557"><a href="#Vocabulary.print_statistics-557"><span class="linenos">557</span></a>                        <span class="s2">&quot;dataset instances, the directly loaded portion won&#39;t be considered here.&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-558"><a href="#Vocabulary.print_statistics-558"><span class="linenos">558</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">----Vocabulary Statistics----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-559"><a href="#Vocabulary.print_statistics-559"><span class="linenos">559</span></a>            <span class="c1"># Since we don&#39;t saved counter info, it is impossible to consider pre-saved portion.</span>
</span><span id="Vocabulary.print_statistics-560"><a href="#Vocabulary.print_statistics-560"><span class="linenos">560</span></a>            <span class="k">for</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">:</span>
</span><span id="Vocabulary.print_statistics-561"><a href="#Vocabulary.print_statistics-561"><span class="linenos">561</span></a>                <span class="n">tokens_with_counts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_retained_counter</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Vocabulary.print_statistics-562"><a href="#Vocabulary.print_statistics-562"><span class="linenos">562</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-563"><a href="#Vocabulary.print_statistics-563"><span class="linenos">563</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 most frequent tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-564"><a href="#Vocabulary.print_statistics-564"><span class="linenos">564</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="Vocabulary.print_statistics-565"><a href="#Vocabulary.print_statistics-565"><span class="linenos">565</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-566"><a href="#Vocabulary.print_statistics-566"><span class="linenos">566</span></a>                <span class="c1"># Now sort by token length, not frequency</span>
</span><span id="Vocabulary.print_statistics-567"><a href="#Vocabulary.print_statistics-567"><span class="linenos">567</span></a>                <span class="n">tokens_with_counts</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-568"><a href="#Vocabulary.print_statistics-568"><span class="linenos">568</span></a>
</span><span id="Vocabulary.print_statistics-569"><a href="#Vocabulary.print_statistics-569"><span class="linenos">569</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 longest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-570"><a href="#Vocabulary.print_statistics-570"><span class="linenos">570</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">tokens_with_counts</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
</span><span id="Vocabulary.print_statistics-571"><a href="#Vocabulary.print_statistics-571"><span class="linenos">571</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-572"><a href="#Vocabulary.print_statistics-572"><span class="linenos">572</span></a>
</span><span id="Vocabulary.print_statistics-573"><a href="#Vocabulary.print_statistics-573"><span class="linenos">573</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Top 10 shortest tokens in namespace &#39;</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-574"><a href="#Vocabulary.print_statistics-574"><span class="linenos">574</span></a>                <span class="k">for</span> <span class="n">token</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tokens_with_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]):</span>
</span><span id="Vocabulary.print_statistics-575"><a href="#Vocabulary.print_statistics-575"><span class="linenos">575</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="se">\t\t</span><span class="s2">length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Frequency: </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Vocabulary.print_statistics-576"><a href="#Vocabulary.print_statistics-576"><span class="linenos">576</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vocabulary.print_statistics-577"><a href="#Vocabulary.print_statistics-577"><span class="linenos">577</span></a>            <span class="c1"># _retained_counter would be set only if instances were used for vocabulary construction.</span>
</span><span id="Vocabulary.print_statistics-578"><a href="#Vocabulary.print_statistics-578"><span class="linenos">578</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Vocabulary statistics cannot be printed since &quot;</span> \
</span><span id="Vocabulary.print_statistics-579"><a href="#Vocabulary.print_statistics-579"><span class="linenos">579</span></a>                        <span class="s2">&quot;dataset instances were not used for its construction.&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>